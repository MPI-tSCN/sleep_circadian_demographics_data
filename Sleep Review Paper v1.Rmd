---
title             : "Study Sample Characteristics in the Sleep and Chronobiology Research: A Systematic Review"
shorttitle        : "Demographics analysis of sleep and chronobiology research"

author: 
  - name          : "Selma Tir"
    affiliation   : "1,2"
    email         : "selma.tir@ndcn.ox.ac.uk"
    role:
      - wrote the original draft protocol, reviewed and scored articles, reviewed and edited the manuscript
  - name          : "Rhiannon White"
    affiliation   : "1,3"
    email         : "r.white.5@warwick.ac.uk"
    role:         
      - reviewed and scored articles, reviewed and edited the manuscript
  - name          : "Manuel Spitschan"
    affiliation   : "1,4,5"
    corresponding : yes    # Define only one corresponding author
    email         : "manuel.spitschan@psy.ox.ac.uk"
    role:
      - wrote the original draft protocol, reviewed and edited the manuscript

affiliation:
  - id            : "1"
    institution   : "Department of Experimental Psychology, University of Oxford, Anna Watts Building, Radcliffe Observatory Quarter, Oxford, OX2 6GG, United Kingdom"
  - id            : "2"
    institution   : "Nuffield Department of Clinical Neurosciences, University of Oxford"
  - id            : "3"
    institution   : "Warwick Medical School, University of Warwick, United Kingdom"
  - id            : "4"
    institution   : "Centre for Chronobiology, Psychiatric Hospital of the University of Basel, Switzerland"
  - id            : "5"
    institution   : "Transfaculty Research Platform Molecular and Cognitive Neurosciences, University of Basel, Switzerland"

authornote: |
  This systematic review is funded by the Wellcome Trust (Sir Henry Wellcome Fellowship to MS 204686/Z/16/Z; Research Enrichment â€“ Diversity & Inclusion WT 204686/Z/16/A) and Linacre College (Biomedical Sciences Junior Research Fellowship to MS).

abstract: |
  Many aspects of sleep and circadian physiology appear to be sensitive to characteristics of the studied population, most notably sex. While recent research robustly highlights the importance of considering participant-level demographic information, it is not clear to what extent this information is available in the large body of already published literature. In this systematic review, we evaluated the study sample characteristics in the published sleep and chronobiology research over the past 40 years.
  
  Articles published between 1979 and 2019 (odd years) in the top eight sleep and chronobiology journals, identified by their five-year Impact Factor, were found through MEDLINE. 6,777 articles were initially included for screening. Inclusion requirements included conducting original research, reporting human data, and recruiting volunteers. The reporting of sample size, age, sex, gender, ethnicity, level of education, socio-economic status, and profession of the study population was scored binarily (0=not reported), and any reported aggregate summary statistics for these variables were recorded. Funding source, geographical location and clinical focus of the article were examined, as well as whether data were analyzed including any of the demographic variables as covariates.
  
  ~75% of screened articles met inclusion criteria. While >90% of studies reported age or sex, all other variables were reported in <10% of cases. We found that sex balance greatly changed over the years, from a ~3:1 male to female ratio in the 1990s to a near-equal representation in the 2010s. Overall, ~75% of studies recruited both male and female participants. Of studies recruiting a single sex, ~50% all-female studies focused on a sex-dependent feature, compared to <5% in all-male studies.
  
  In this comprehensive review, we found that the majority of studies report at least sex or age, while many other important variables are typically not reported. Reporting quality is highly variable, indicating an opportunity to standardize reporting guidelines for participant-level characteristics to facilitate disaggregated data analyses.

  
  <!-- https://tinyurl.com/ybremelq -->
  
keywords          : "Study Sample Characteristics, Demographics, Sex, Systematic Review"
wordcount         : "X"

bibliography      : ["r-references.bib"]

floatsintext      : no
figurelist        : yes
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : yes

documentclass     : "apa6"
classoption       : "jou"
output            : papaja::apa6_pdf
---


```{r setup, include=FALSE}
# Version control
## R version 4.0.4 (2021-02-15)
## R Studio version 1.4.1106
## Macintosh; Intel Mac OS X 10.13.6

# Load packages
library("papaja")
library(corrplot)
library(dplyr)
library(ggplot2)
library(ggthemes)
library(ggExtra)
library(ggsci)
library(graphics)
library(gridExtra)
library(knitr)
library(latticeExtra)
library(mosaic)
library(pracma)
library(readr)
library(readxl)
library(reshape2)
library(stats) 
library(stringr)
library(tibble)
library(tidyr)
library(lemon)
r_refs("r-references.bib")

# Set working directory
setwd("~/Projects/sleep_circadian_demographics_data")

# Download scoring sheet 
data.original <- read_excel("scoring_rhiannon.xlsx")
```

# Introduction 

  Many aspects of sleep and circadian physiology appear to be sensitive to characteristics of the studied population, most notably sex. While recent research robustly highlights the importance of considering participant-level demographic information, it is not clear to what extent this information is available in the large body of already published literature. In this systematic review, we evaluated the study sample characteristics in the published sleep and chronobiology research over the past 40 years.

  
# Methods
  
  Journal articles published between 1979 and 2019 (odd years) in the top eight sleep and chronobiology journals  were found through MEDLINE by MS. The eight journals were selected based on their five-year Impact Factor, and included Journal of Pineal Research, Sleep, Journal of Sleep Research, Sleep Medicine, Journal of Clinical Medicine, Journal of Biological Rhythms, Behavioral Sleep Medicine, and Chronobiology International. 6,777 articles were initially sampled for screening. Inclusion requirements included conducting original research in the English language, reporting human data, and recruiting volunteers. As such, animal studies, bibliographies, case reports, comments, conference proceedings, editorials, guidelines, letters, retracted publications, reviews, erratums and corrigendums were excluded. All articles were reviewed for eligibility and coded by ST. The reporting of sample size, age, sex, gender, ethnicity, level of education, socio-economic status, and profession of the study population was scored binarily (0 = not reported, 1 = reported), and any reported aggregate summary statistics for these variables were recorded. Funding source, geographical location and clinical focus of the article were examined, as well as whether data were analyzed by including any of the demographic variables as covariates. 


```{r Inclusion & Exclusion, echo=FALSE, message=FALSE, warning=FALSE}
# Filter reviewed articles
data.original <- data.original %>%
  filter(article_fulltext_available_yn == 1)

# Separate included and excluded articles
data.included <- data.original %>%
  filter(article_included_yn == 1)

data.excluded <- data.original %>%
  filter(article_included_yn == 0)

# Check that the number of included and excluded articles is equal to the total (return TRUE if yes)
check.article.number <- (as.numeric(nrow(data.included)) + as.numeric(nrow(data.excluded))) == as.numeric(nrow(data.original))

# Compute percentage of included vs excluded articles, and round to two decimals
percent.included <- round(as.numeric(nrow(data.included))/as.numeric(nrow(data.original)) * 100, 2)
percent.excluded <- round(as.numeric(nrow(data.excluded))/as.numeric(nrow(data.original)) * 100, 2)

# Compute percentage of articles that were excluded for other reasons
data.excluded.other <- data.excluded %>%
  filter(!is.na(article_excluded_reason_other))
percent.excluded.other <- round(nrow(data.excluded.other)/nrow(data.excluded) * 100, 2)

# Compute percentage of excluded articles by reason for exclusion
data.eligibility <- data.original
data.eligibility$article_excluded_reason <- tolower(data.eligibility$article_excluded_reason) 

data.eligibility <- data.eligibility %>%
  mutate(eligibility=if_else(!is.na(article_excluded_reason_other), "Not included for other reasons", 
                          if_else(article_included_yn == 1, "Included",
                                  if_else(article_excluded_reason == "not recruiting volunteers", 
                                          "Not recruiting volunteers",
                                          if_else(article_excluded_reason == "not an original research article",
                                                  "Not an original research article",
                                                  if_else(article_excluded_reason == "not reporting human data",
                                                          "Not reporting human data",
                                                          "NA"))))))

data.eligibility <- data.eligibility %>%
  count(eligibility, article_year) %>%
  ungroup()

data.eligibility <- data.eligibility %>%
  group_by(article_year) %>%
  mutate(total=sum(n)) %>%
  group_by(eligibility) %>%
  mutate(per=round(100*n/total, 2))

data.eligibility$article_year <- as.numeric(data.eligibility$article_year)
data.eligibility$per <- as.numeric(data.eligibility$per)

# Stacked bar chart of excluded articles by reason for exclusion across the years
figure1B <- ggplot(data.eligibility, aes(x=article_year, y=per)) +
  geom_col(aes(fill=factor(eligibility, levels=c("Not an original research article",
                                                 "Not reporting human data",
                                                 "Not included for other reasons",
                                                 "Not recruiting volunteers",
                                                 "NA",
                                                 "Included")))) +
  theme_apa() +
  xlab("Year of publication") +
  ylab("Percentage of articles") +
  labs(fill="Eligibility") +
  scale_x_continuous(breaks=c(1979,1989,1999,2009,2019)) +
  scale_y_continuous(expand=c(0,0)) +
  scale_fill_manual(values=c("#29AF7FFF","#482677FF","#D8DE29FF","#FDE725FF","#2D708EFF")) +
  theme(axis.title=element_text(face="bold", size=14), axis.text=element_text(colour="black", face="bold"), 
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8),
        legend.title=element_text(face="bold", size=12), legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,0,-10,-10))
```

```{r Funding, include=FALSE}
# Select articles that report funding
data.funding.name <- data.included %>%
  filter(funding_reported_yn == 1)

# Compute percentage of articles that report funding
percent.funding.name <- round(nrow(data.funding.name)/as.numeric(nrow(data.included)) * 100, 2)

# Select articles that report funding number
data.funding.num <- data.included %>%
  filter(funding_refnum_yn == 1)

# Compute percentage of articles that report funding number, out of those that report funding
percent.funding.num <- round(nrow(data.funding.num)/as.numeric(nrow(data.funding.name)) * 100, 2)

list.funding <- tolower(data.included$funding_names)

# Split the category combinations and convert to lower case letters
list.funding <- as.list(strsplit(list.funding, ","))
list.funding <- unlist(list.funding)

# Count number of occurrences for each category
table.list.funding <- as.data.frame(table(list.funding))
n.funding.nih <- sum(str_count(list.funding, "nih"), str_count(list.funding, "national institute"))

# Compute percentage of articles that report funding from the National Institutes in the US
data.funding.NI <- data.funding.name %>%
  filter(grepl("NI", funding_names) | grepl("National Institute", funding_names))

percent.funding.NI <- round(nrow(data.funding.NI)/as.numeric(nrow(data.included)) * 100, 2)

# Select articles that report funding number and funding from NIH in the US
data.funding.NI.num <- data.funding.name %>%
  filter(grepl("NI", funding_names) | grepl("National Institute", funding_names)) %>%
  filter(funding_refnum_yn == 1)

percent.funding.NI.num <- round(nrow(data.funding.NI.num)/as.numeric(nrow(data.funding.NI)) * 100, 2)
```

```{r Study Country, echo=FALSE, message=FALSE, warning=FALSE}
# Set country code to upper case
data.included$study_country_values <- toupper(data.included$study_country_values)

# Separate articles for which country is reported explicitly vs inferred
data.country.reported <- data.included %>%
  filter(study_country_reported_explicitly_yn == 1)

data.country.inferred <- data.included %>%
  filter(study_country_reported_inferred_yn == 1)

# Compute percentage of articles where country is reported explicitly vs inferred
percent.country.reported <- round(nrow(data.country.reported)/nrow(data.included) * 100, 2)
percent.country.inferred <- round(nrow(data.country.inferred)/nrow(data.included) * 100, 2)

# Separate articles that report one or multiple countries of study
country.single <- data.included %>%
  filter(!grepl(",", study_country_values)) %>%
  group_by(study_country_values) %>%
  tally() %>%
  mutate(n=round((n/as.numeric(nrow(data.included))*100),1))

country.multiple <- data.included %>%
  filter(grepl(",", study_country_values)) %>%
  group_by(study_country_values) %>%
  tally() %>%
  mutate(n=round((n/as.numeric(nrow(data.included))*100),1))

# Compute percentage of articles where multiple countries of study are reported
percent.country.multiple <- round(nrow(country.multiple)/nrow(data.included) * 100, 2)

# Examine countries that are the most represented overall for studies that report a single country
country.single.maj <- country.single %>%
  filter(n>4)

pc.country.single.maj <- ggplot(data=country.single.maj, aes(x="", y=n, fill=study_country_values)) +
  geom_bar(stat="identity", width=1, color="white") +
  coord_polar("y", start=0) +
  geom_text(aes(label=paste0(n, "%")), position=position_stack(vjust=0.5)) +
  ggtitle("Countries most represented overall") +
  labs(fill="Country") +
  scale_fill_brewer(palette="RdBu") +
  theme_void()

# Compute number of articles for the 8 most represented countries by year of publication
# Select articles where a single country is reported or inferred
data.country <- data.included %>%
  filter(!grepl(",", study_country_values)) %>%
  count(study_country_values, article_year) %>%
  ungroup()

# we checked what were the 8 most represented countries overall in the pie chart above

# Change all countries that are not the 8 most represented countries to 'Other'
data.country$study_country_values[data.country$study_country_values != "AUS" &
                                    data.country$study_country_values != "CAN" &
                                    data.country$study_country_values != "DEU" &
                                    data.country$study_country_values != "FRA" &
                                    data.country$study_country_values != "GBR" &
                                    data.country$study_country_values != "USA" &
                                    data.country$study_country_values != "ITA" &
                                    data.country$study_country_values != "JPN"] <- "Other"

# Sum rows with 'Other' by year
data.country <- aggregate(cbind(n) ~ study_country_values + article_year, data=data.country, FUN=sum)

# Compute proportion of articles per country by year of publication
data.country <- data.country %>%
  group_by(article_year) %>%
  mutate(total=sum(n)) %>%
  group_by(study_country_values) %>%
  mutate(per=round(100*n/total, 2))

data.country$article_year <- as.numeric(data.country$article_year)
data.country$per <- as.numeric(data.country$per)

# Stacked bar chart of 8 most represented study countries by year of publication
figure2B <- ggplot(data.country, aes(x=article_year, y=per)) +
  geom_col(aes(fill=factor(study_country_values, levels=c("Other","AUS","CAN","DEU","FRA",
                                                          "GBR","ITA","JPN","USA")))) +
  theme_apa() +
  xlab("Year of publication") +
  ylab("Percentage of articles") +
  labs(fill="Country") +
  scale_x_continuous(breaks=c(1979,1989,1999,2009,2019)) +
  scale_y_continuous(expand=c(0,0)) +
  scale_fill_viridis_d(direction=-1) +
  theme(axis.title=element_text(face="bold", size=14), axis.text=element_text(colour="black", face="bold"), 
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8),
        legend.title=element_text(face="bold", size=12), legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,0,-10,-10))
```

```{r Number of sub-studies, echo=FALSE, message=FALSE, warning=FALSE}
# Compute percentage of articles per number of sub-studies
num.study <- data.included %>%
  group_by(num_substudies) %>%
  tally() %>%
  mutate(num_substudies=as.factor(num_substudies),
         n=round((n/as.numeric(nrow(data.included))*100),1))

percent.study.single <- num.study$n[1]
percent.study.multiple <- 1 - num.study$n[1]

### The rest  of the analysis will be conducted on single studies
# Filter single studies
data <- data.included %>%
  filter(num_substudies == 1)
```

  Data were coded in an Excel Spreadsheet and analyzed in R Studio (version 4.0.4). Reporting of funding, geographical location, and number of sub-studies for each article were investigated for the sample of articles that passed all eligibility criteria. The rest of the analysis was conducted on the subset of articles that reported a single study (`r round(percent.study.single)`% of articles), i.e. a single sample population. 

```{r Sample size, echo=FALSE, message=FALSE, warning=FALSE}
# Compute percentage of studies that report sample size
data.ss <- data %>%
  filter(sample_size_bycategory_reported_yn == 1)

percent.ss <- round(nrow(data.ss)/nrow(data) * 100, 2)

# Violin plot of sample size by year of publication with log10 scaling
data.ss$article_year <- as.factor(data.ss$article_year)
data.ss$sample_size_total_reported_values <- as.numeric(data.ss$sample_size_total_reported_values)

figure3 <- ggplot(data.ss, aes(x=article_year, y=sample_size_total_reported_values)) +
  geom_violin(fill="#440154FF") +
  theme_apa() +
  scale_y_continuous(trans='log10', breaks=c(10,1000,100000), labels=c("10","1,000","100,000"), expand=c(0,0)) +
  scale_x_discrete(breaks=c("1979","1989","1999","2009","2019")) +
  xlab("Year of publication") +
  ylab("Sample size, log-10 scaling") +
  annotation_logticks(sides="l") +
  theme(axis.title=element_text(face="bold", size=14), axis.text=element_text(colour="black", face="bold"), 
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8))
```

```{r Age, echo=FALSE, message=FALSE, warning=FALSE}
# Select articles that report age
data.age <- data.included %>%
  filter(age_reported_mean_yn == 1 | age_reported_median_yn == 1 | age_reported_min_yn | age_reported_max_yn | age_reported_other_yn == 1 | age_reported_by_sex_yn == 1)

# Compute percentage of articles where age is reported
percent.age <- round(nrow(data.age)/nrow(data.included) * 100, 2)

## Correlate the reporting of age variables by year
# select year and age columns
data.age.year <- data.age %>%
  select(article_year, age_reported_mean_yn, age_reported_sd_yn, age_reported_median_yn, 
         age_reported_min_yn, age_reported_max_yn, age_reported_iqr_yn, age_reported_other_yn)

# Replace 0 by -1
data.age.year$age_reported_mean_yn[data.age.year$age_reported_mean_yn == 0] <- -1
data.age.year$age_reported_sd_yn[data.age.year$age_reported_sd_yn == 0] <- -1
data.age.year$age_reported_median_yn[data.age.year$age_reported_median_yn == 0] <- -1
data.age.year$age_reported_min_yn[data.age.year$age_reported_min_yn == 0] <- -1
data.age.year$age_reported_max_yn[data.age.year$age_reported_max_yn == 0] <- -1
data.age.year$age_reported_iqr_yn[data.age.year$age_reported_iqr_yn == 0] <- -1
data.age.year$age_reported_other_yn[data.age.year$age_reported_other_yn == 0] <- -1

# Replace NAs
data.age.year[is.na(data.age.year)] <- -1

# Group by year and compute the average for each sex variable
age.corr.year <- data.age.year %>%
  group_by(article_year) %>%
  summarise(mean=mean(age_reported_mean_yn), sd=mean(age_reported_sd_yn), median=mean(age_reported_median_yn),
            min=mean(age_reported_min_yn), max=mean(age_reported_max_yn), iqr=mean(age_reported_iqr_yn),
            other=mean(age_reported_other_yn))  %>%
  ungroup()

age.corr.year <- age.corr.year %>%
  group_by(article_year) %>%
  mutate(total=((mean+sd+median+min+max+iqr+other)/7))

# Reshape data
age.corr.year <- melt(age.corr.year,id.vars='article_year',measure.vars=c('mean','sd','median','min','max','iqr','other','total'))

# Heat map of reporting of age variables by year of publication
figure4A <- ggplot(data=age.corr.year, aes(x=variable, y=article_year, fill=value)) +
  geom_tile() +
  theme_apa() +
  ylab(label="Year") +
  xlab("Age variable") +
  scale_fill_viridis_c(end=0.6, direction=-1, labels=c("0.0","0.25","0.5","0.75","1")) +
  theme(axis.title=element_text(face="bold", size=14), axis.text=element_text(colour="black", face="bold"), 
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8), legend.position="none",
        legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,0,-10,-10),
        legend.title=element_blank())

## Correlate the reporting of age variables by journal
# Select journal and age columns
data.age.journal <- data.age %>%
  select(article_journal, age_reported_mean_yn, age_reported_sd_yn, age_reported_median_yn, 
         age_reported_min_yn, age_reported_max_yn, age_reported_iqr_yn, age_reported_other_yn)

# Replace 0 by -1
data.age.journal$age_reported_mean_yn[data.age.journal$age_reported_mean_yn == 0] <- -1
data.age.journal$age_reported_sd_yn[data.age.journal$age_reported_sd_yn == 0] <- -1
data.age.journal$age_reported_median_yn[data.age.journal$age_reported_median_yn == 0] <- -1
data.age.journal$age_reported_min_yn[data.age.journal$age_reported_min_yn == 0] <- -1
data.age.journal$age_reported_max_yn[data.age.journal$age_reported_max_yn == 0] <- -1
data.age.journal$age_reported_iqr_yn[data.age.journal$age_reported_iqr_yn == 0] <- -1
data.age.journal$age_reported_other_yn[data.age.journal$age_reported_other_yn == 0] <- -1

# Replace NAs
data.age.journal[is.na(data.age.journal)] <- -1

# Group by journal and compute the average for each sex variable
age.corr.journal <- data.age.journal %>%
  group_by(article_journal) %>%
  summarise(mean=mean(age_reported_mean_yn), sd=mean(age_reported_sd_yn), median=mean(age_reported_median_yn),
            min=mean(age_reported_min_yn), max=mean(age_reported_max_yn), iqr=mean(age_reported_iqr_yn),
            other=mean(age_reported_other_yn)) %>%
  ungroup()

age.corr.journal <- age.corr.journal %>%
  group_by(article_journal) %>%
  mutate(total=((mean+sd+median+min+max+iqr+other)/7))

# Reshape data
age.corr.journal <- melt(age.corr.journal,id.vars='article_journal',
                         measure.vars=c('mean','sd','median','min','max','iqr','other','total'))

# Heat map of reporting of age variables by journal of publication
figure4B <- ggplot(data=age.corr.journal, aes(x=variable, y=article_journal, fill=value)) +
  geom_tile() +
  theme_apa() +
  ylab(label="Journal") +
  xlab("Age variable") +
  scale_fill_viridis_c(end=0.6, direction=-1, labels=c("0.0","0.25","0.5","0.75","1")) +
  theme(axis.title=element_text(face="bold", size=14), axis.text=element_text(colour="black", face="bold"), 
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8), legend.position="right",
        legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,0,-10,-10),
        legend.title=element_blank())

## Regression for age by year of publication
data.age.mean <- data.age %>%
  filter(age_reported_mean_yn == 1) %>%
  filter(!is.na(as.numeric(age_reported_mean_value)))

data.age.mean$age_reported_mean_value <- as.numeric(data.age.mean$age_reported_mean_value)

figure4C <- ggplot(data=data.age.mean, aes(x=article_year, y=age_reported_mean_value)) +
  geom_smooth(method="lm", color="#440154FF") +
  theme_apa() +
  ylab("Mean age") +
  xlab("Year") +
  scale_x_continuous(breaks=c(1979,1989,1999,2009,2019)) +
  scale_y_continuous(limits=c(20,60), expand=c(0,0)) +
  theme(axis.title=element_text(face="bold", size=14), axis.text=element_text(colour="black", face="bold"), 
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8)) 
```

```{r Sex, echo=FALSE, message=FALSE, warning=FALSE}
# Select sex variables       
data.sex <- data.included %>%
  select(article_year, sex_reported_yn, 
         sex_reported_num_male, sex_reported_percent_male,
         sex_reported_num_female,sex_reported_percent_female)

# Compute whether males or females are reported at all
data.sex$male <- ifelse(is.na(data.sex$sex_reported_num_male) & is.na(data.sex$sex_reported_percent_male),
                             "No",
                             "Yes")
data.sex$male <- as.factor(data.sex$male)
data.sex$female <- ifelse(is.na(data.sex$sex_reported_num_female) & is.na(data.sex$sex_reported_percent_female),
                             "No",
                             "Yes")
data.sex$female <- as.factor(data.sex$female)

# Compute whether articles report males, females, both or unspecified
data.sex <- data.sex %>%
  mutate(report=if_else(male == "Yes" & female == "Yes", "Both Sexes", 
                          if_else(male == "Yes" & female == "No", "Male",
                                  if_else(male == "No" & female == "Yes", "Female", "Unspecified"))))

# Count number of articles for each sex condition by year of publication
data.sex <- data.sex %>%
  count(report, article_year) %>%
  ungroup()

# Compute proportion of articles per sex category by year of publication
data.sex <- data.sex %>%
  group_by(article_year) %>%
  mutate(total=sum(n)) %>%
  group_by(report, add=TRUE) %>%
  mutate(per=round(100*n/total,2))

data.sex$article_year <- as.numeric(data.sex$article_year)
data.sex$per <- as.numeric(data.sex$per)

# Stacked bar chart of sex reporting by year of publication
figure5A <- ggplot(data.sex, aes(x=article_year, y=per)) +
  geom_col(aes(fill=factor(report, levels=c("Female",
                                            "Unspecified",
                                            "Both Sexes",
                                            "Male")))) +
  theme_apa() +
  xlab("Year of publication") +
  ylab("Percentage of articles") +
  labs(fill="Sex") +
  scale_fill_manual(values=c("#482677FF","#D8DE29FF","#29AF7FFF","#2D708EFF")) +
  scale_x_continuous(breaks=c(1979,1989,1999,2009,2019)) +
  scale_y_continuous(expand=c(0,0)) +
  theme(axis.title=element_text(face="bold", size=14), axis.text=element_text(colour="black", face="bold"), 
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8),
        legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,0,-10,-10)) 
  

# Select articles for which sex is reported
data.sex.reported <- data.included %>%
  filter(sex_reported_yn == 1) %>%
  mutate(sample_size_total_reported_values=as.numeric(sample_size_total_reported_values),
         sex_reported_num_male=as.numeric(sex_reported_num_male),
         sex_reported_percent_male=as.numeric(sex_reported_percent_male),
         sex_reported_num_female=as.numeric(sex_reported_num_female),
         sex_reported_percent_female=as.numeric(sex_reported_percent_female))

# Select articles for which intersex is reported
data.intersex <- data.included %>%
  filter(sex_reported_intersex_yn == 1)

# compute percentage of articles where sex and intersex is reported
percent.sex <- round(nrow(data.sex.reported)/nrow(data.included) * 100, 2)
percent.intersex <- round(nrow(data.intersex)/nrow(data.included) * 100, 2)

# Compute whether males or females are recruited in the articles that report  sex
data.sex.reported$male <- ifelse(is.na(data.sex.reported$sex_reported_num_male) &
                                   is.na(data.sex.reported$sex_reported_percent_male),
                             "No",
                             "Yes")
data.sex.reported$male <- as.factor(data.sex.reported$male)
data.sex.reported$female <- ifelse(is.na(data.sex.reported$sex_reported_num_female) &
                                     is.na(data.sex.reported$sex_reported_percent_female),
                             "No",
                             "Yes")
data.sex.reported$female <- as.factor(data.sex.reported$female)

# Compute whether articles report males, females or both
data.sex.reported <- data.sex.reported %>%
  mutate(report=if_else(male == "Yes" & female == "Yes", "Both Sexes", 
                          if_else(male == "Yes" & female == "No", "Male",
                                  if_else(male == "No" & female == "Yes", "Female", "NA"))))

# Compute percentage of articles that only recruit males or females
data.sex.male <- data.sex.reported %>%
  filter(report=="Male")

percent.sex.male <- round(nrow(data.sex.male)/nrow(data.sex.reported) * 100, 2)

data.sex.female <- data.sex.reported %>%
  filter(report=="Female")

percent.sex.female <- round(nrow(data.sex.female)/nrow(data.sex.reported) * 100, 2)

# Compute percentage of articles reporting on a sex-dependent feature
data.sex.male.focus <- data.sex.male %>%
  filter(sample_focus_sex_dependent_yn == 1)

percent.sex.male.focus <- round(nrow(data.sex.male.focus)/nrow(data.sex.male) * 100, 2)

data.sex.female.focus <- data.sex.female %>%
  filter(sample_focus_sex_dependent_yn == 1)

percent.sex.female.focus <- round(nrow(data.sex.female.focus)/nrow(data.sex.female) * 100, 2)

# Compute percentage of studies reporting age by sex
data.sex.age <- data.included %>%
  filter(age_reported_by_sex_yn == 1)

percent.sex.age <- round(nrow(data.sex.age)/nrow(data.included) * 100, 2)
```

```{r Other demographics, echo=FALSE, message=FALSE, warning=FALSE}
# Select single studies and other demographic variables
data.demo <- data.included %>%
  select(article_year, ethnicity_reported_yn, education_reported_mean_yn, education_reported_yn,
         profession_reported_yn, ses_reported_yn)

# Compute the reporting of the different demographic variables
data.demo <- data.demo %>%
  mutate(education=if_else(education_reported_mean_yn == 0 & education_reported_yn == 0, "No", "Yes"),
         ethnicity=if_else(ethnicity_reported_yn == 1, "Yes", "No"),
         profession=if_else(profession_reported_yn == 1, "Yes", "No"),
         ses=if_else(ses_reported_yn == 1, "Yes", "No"))

# Count number of articles for each demographic variable by year of publication
data.demo.education <- data.demo %>%
  count(education, article_year) %>%
  ungroup()

data.demo.ethnicity <- data.demo %>%
  count(ethnicity, article_year) %>%
  ungroup()

data.demo.profession <- data.demo %>%
  count(profession, article_year) %>%
  ungroup()

data.demo.ses <- data.demo %>%
  count(ses, article_year) %>%
  ungroup()

# Compute proportion of articles by year of publication
data.demo.education <- data.demo.education %>%
  group_by(article_year) %>%
  mutate(total=sum(n)) %>%
  group_by(education, add=TRUE) %>%
  mutate(per=round(100*n/total,2),
         variable="edu") %>%
  select(article_year, variable, education, per)
colnames(data.demo.education)[3] <- "report"

data.demo.ethnicity <- data.demo.ethnicity %>%
  group_by(article_year) %>%
  mutate(total=sum(n)) %>%
  group_by(ethnicity, add=TRUE) %>%
  mutate(per=round(100*n/total,2),
         variable="ethni") %>%
  select(article_year, variable, ethnicity, per)
colnames(data.demo.ethnicity)[3] <- "report"

data.demo.profession <- data.demo.profession %>%
  group_by(article_year) %>%
  mutate(total=sum(n)) %>%
  group_by(profession, add=TRUE) %>%
  mutate(per=round(100*n/total,2),
         variable="prof") %>%
  select(article_year, variable, profession, per)
colnames(data.demo.profession)[3] <- "report"

data.demo.ses <- data.demo.ses %>%
  group_by(article_year) %>%
  mutate(total=sum(n)) %>%
  group_by(ses, add=TRUE) %>%
  mutate(per=round(100*n/total,2),
         variable="ses") %>%
  select(article_year, variable, ses, per)
colnames(data.demo.ses)[3] <- "report"

# Merge back the datasets together
merge1 <- rbind(data.demo.education, data.demo.ethnicity)
merge2 <- rbind(merge1, data.demo.profession)
data.demo <- rbind(merge2, data.demo.ses)

data.demo$article_year <- as.numeric(data.demo$article_year)
data.demo$per <- as.numeric(data.demo$per)

# Stacked bar chart  of reporting of other demographic variables by year of publication
figure6.bars <- ggplot(data.demo, aes(x=variable, y=per, fill=report)) +
  geom_bar(stat="identity") +
  facet_grid(~article_year) +
  theme_apa() +
  xlab("Year of publication") +
  ylab("Percentage of articles") +
  labs(fill="Variable reported") +
  scale_fill_manual(values=c("#482677FF","#D8DE29FF")) +
  theme(axis.title=element_text(face="bold", size=14), axis.text=element_text(colour="black", face="bold"),
        axis.text.x=element_text(size=5, angle=45, hjust=1),
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8),
        legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,0,-10,-10),
        panel.spacing=unit(0.1, "lines")) 

data.demo.reported <- data.demo %>%
  filter(report == "Yes")

figure6.points <- ggplot(data.demo.reported, aes(x=article_year, y=per, color=factor(variable))) +
  geom_point(size=2.5) +
  geom_line(linetype="dashed") +
  theme_apa() +
  xlab("Year of publication") +
  ylab("Percentage of articles") +
  scale_color_viridis_d(name="Variable", labels=c("Education","Ethnicity","Profession","Socio-economic status")) +
  scale_x_continuous(breaks=c(1979,1989,1999,2009,2019)) +
  scale_y_continuous(limits=c(0,100), expand=c(0,0)) +
  theme(axis.title=element_text(face="bold", size=14), axis.text=element_text(colour="black", face="bold"),
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8),
        legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,0,-10,-10)) 

# Compute percentage of articles that report education
data.education <- data.included %>%
  filter(education_reported_mean_yn == 1 | education_reported_yn == 1)

percent.education <- round(nrow(data.education)/nrow(data.included) * 100, 2)

# Compute distribution of the number of categories reported for education
data.education$education_reported_numcategory <- as.numeric(data.education$education_reported_numcategory)

figure7A <- ggplot(data=data.education, aes(x=education_reported_numcategory)) +
  geom_histogram(binwidth=1, aes(y=..density..), colour="black", fill="#2D708EFF") +
  geom_vline(aes(xintercept=mean(education_reported_numcategory, na.rm=TRUE)), color="#D8DE29FF", size=1) +
  theme_apa() +
  ylab("Density") +
  xlab("Education") +
  scale_x_continuous(limits=c(0.5,8.5), breaks=c(1,2,3,4,5,6,7,8)) +
  scale_y_continuous(limits=c(0,0.5), expand=c(0,0)) +
  theme(axis.title=element_text(face="bold", size=14), axis.text=element_text(colour="black", face="bold"),
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8)) 

# Compute percentage of articles that report ethnicity
data.ethnicity <- data.included %>%
  filter(ethnicity_reported_yn == 1)

percent.ethnicity <- round(nrow(data.ethnicity)/nrow(data.included) * 100, 2)

# Compute distribution of the number of categories reported for ethnicity
data.ethnicity$ethnicity_reported_numcategory <- as.numeric(data.ethnicity$ethnicity_reported_numcategory)

figure7B <- ggplot(data=data.ethnicity, aes(x=ethnicity_reported_numcategory)) +
  geom_histogram(binwidth=1, aes(y=..density..), colour="black", fill="#2D708EFF") +
  geom_vline(aes(xintercept=mean(ethnicity_reported_numcategory, na.rm=TRUE)), color="#D8DE29FF", size=1) +
  theme_apa() +
  ylab("Density") +
  xlab("Ethnicity") +
  scale_x_continuous(limits=c(0.5,8.5), breaks=c(1,2,3,4,5,6,7,8)) +
  scale_y_continuous(limits=c(0,0.5), expand=c(0,0)) +
  theme(axis.title=element_text(face="bold", size=14), axis.text=element_text(colour="black", face="bold"),
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8)) 

# Compute percentage of articles that report profession
data.profession <- data.included %>%
  filter(profession_reported_yn == 1)

percent.profession <- round(nrow(data.profession)/nrow(data.included) * 100, 2)

# Compute distribution of the number of categories reported for profession
data.profession$profession_reported_numcategory <- as.numeric(data.profession$profession_reported_numcategory)

figure7C <- ggplot(data=data.profession, aes(x=profession_reported_numcategory)) +
  geom_histogram(binwidth=1, aes(y=..density..), colour="black", fill="#2D708EFF") +
  geom_vline(aes(xintercept=mean(profession_reported_numcategory, na.rm=TRUE)), color="#D8DE29FF", size=1) +
  theme_apa() +
  ylab("Density") +
  xlab("Profession") +
  scale_x_continuous(limits=c(0.5,8.5), breaks=c(1,2,3,4,5,6,7,8)) +
  scale_y_continuous(limits=c(0,0.5), expand=c(0,0)) +
  theme(axis.title=element_text(face="bold", size=14), axis.text=element_text(colour="black", face="bold"),
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8)) 

# Compute percentage of articles that report ses
data.ses <- data.included %>%
  filter(ses_reported_yn ==1)

percent.ses <- round(nrow(data.ses)/nrow(data.included) * 100, 2)

# Compute distribution of the number of categories reported for ses
data.ses$ses_reported_numcategory <- as.numeric(data.ses$ses_reported_numcategory)

figure7D <- ggplot(data=data.ses, aes(x=ses_reported_numcategory)) +
  geom_histogram(binwidth=1, aes(y=..density..), colour="black", fill="#2D708EFF") +
  geom_vline(aes(xintercept=mean(ses_reported_numcategory, na.rm=TRUE)), color="#D8DE29FF", size=1) +
  theme_apa() +
  ylab("Density") +
  xlab("SES") +
  scale_x_continuous(limits=c(0.5,8.5), breaks=c(1,2,3,4,5,6,7,8)) +
  scale_y_continuous(limits=c(0,0.5), expand=c(0,0)) +
  theme(axis.title=element_text(face="bold", size=14), axis.text=element_text(colour="black", face="bold"),
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8)) 
```

```{r Focus, echo=FALSE, message=FALSE, warning=FALSE}
## Sex feature
# Compute percentage of articles focusing on a sex dependent feature
data.focus.sex <- data.included %>%
  filter(sample_focus_sex_dependent_yn == 1)

percent.focus.sex <- round(nrow(data.focus.sex)/nrow(data.included) * 100, 2)

# Compute number of articles per sex dependent feature 
sex.dependent <- data.focus.sex %>%
  group_by(sample_focus_sex_dependent) %>%
  tally() %>%
  mutate(n=round((n/nrow(data.focus.sex)*100),1))

# Pie chart of the reported sex dependent features 
pc.sex.dependent <- ggplot(data=sex.dependent, aes(x="", y=n, fill=sample_focus_sex_dependent)) +
  geom_bar(stat="identity", width=1, color="white") +
  coord_polar("y", start=0) +
  geom_text(aes(label=paste0(n, "%")), position=position_stack(vjust=0.5)) +
  ggtitle("Articles focused on a sex dependent feature") +
  labs(fill="Sex dependent feature") +
  scale_fill_brewer(palette="RdBu") +
  theme_apa()

## Clinical feature
# Compute percentage of articles focusing on a clinical feature
data.focus.clinical <- data.included %>%
  filter(sample_focus_clinical_yn == 1)

percent.focus.clinical <- round(nrow(data.focus.clinical)/nrow(data.included) * 100, 2)

# Compute number of articles per clinical feature 
clinical <- data.focus.clinical %>%
  group_by(sample_focus_clinical) %>%
  tally() %>%
  mutate(n=round((n/nrow(data.focus.clinical)*100),1))

# Pie chart of the reported clinical features 
pc.clinical <- ggplot(data=clinical, aes(x="", y=n, fill=sample_focus_clinical)) +
  geom_bar(stat="identity", width=1, color="white") +
  coord_polar("y", start=0) +
  geom_text(aes(label=paste0(n, "%")), position=position_stack(vjust=0.5)) +
  ggtitle("Articles focused on a clinical feature") +
  labs(fill="Clinical feature") +
  scale_fill_brewer(palette="RdBu") +
  theme_void()

## Twins
# Compute percentage of articles focusing on twins
data.focus.twins <- data.included %>%
  filter(sample_focus_twins == 1)

percent.focus.twins <- round(nrow(data.focus.twins)/nrow(data.included) * 100, 2)

## University students
# Compute percentage of articles focusing on university students
data.focus.students <- data.included %>%
  filter(sample_focus_university_students == 1)

percent.focus.students <- round(nrow(data.focus.students)/nrow(data.included) * 100, 2)

## Shift workers
# Compute percentage of articles focusing on shift workers
data.focus.shift <- data.included %>%
  filter(sample_focus_shift_workers == 1)

percent.focus.shift <- round(nrow(data.focus.shift)/nrow(data.included) * 100, 2)

## Pregnant women
# Compute percentage of articles focusing on pregnant women
data.focus.pregnant <- data.included %>%
  filter(sample_focus_pregnant_women == 1)

percent.focus.pregnant <- round(nrow(data.focus.pregnant)/nrow(data.included) * 100, 2)
```


```{r Disaggregation, echo=FALSE, warning=FALSE, message=FALSE}
# Select articles that report no difference in results based on age vs use age as a covariate
data.diff.age <- data.included %>%
  filter(analysis_no_difference_age == 1)

data.dis.age <- data.included %>%
  filter(analysis_disaggregation_age == 1)

# Select articles that report no difference in results based on sex vs use sex as a covariate
data.diff.sex <- data.included %>%
  filter(analysis_no_difference_sex == 1)

data.dis.sex <- data.included %>%
  filter(analysis_disaggregation_sex == 1)

# Select articles that report no difference in results based on ethnicity vs use ethnicity as a covariate
data.diff.ethnicity <- data.included %>%
  filter(analysis_no_difference_ethnicity == 1)

data.dis.ethnicity <- data.included %>%
  filter(analysis_disaggregation_ethnicity == 1)

# Select articles that report no difference in results based on education vs use education as a covariate
data.diff.education <- data.included %>%
  filter(analysis_no_difference_education == 1)

data.dis.education <- data.included %>%
  filter(analysis_disaggregation_education == 1)

# Select articles that report no difference in results based on profession vs use profession as a covariate
data.diff.profession <- data.included %>%
  filter(analysis_no_difference_profession == 1)

data.dis.profession <- data.included %>%
  filter(analysis_disaggregation_profession == 1)

# Select articles that report no difference in results based on ses vs use ses as a covariate
data.diff.ses <- data.included %>%
  filter(analysis_no_difference_ses == 1)

data.dis.ses <- data.included %>%
  filter(analysis_disaggregation_ses == 1)

# Select single studies and disaggregation variables
data.analysis <- data.included %>%
  select(article_year, analysis_disaggregation_age, analysis_disaggregation_sex, analysis_disaggregation_ethnicity, 
         analysis_disaggregation_education, analysis_disaggregation_profession, analysis_disaggregation_ses)

# Compute whether articles use ddemographic variables in the analysis
data.analysis <- data.analysis %>%
  mutate(report=if_else(analysis_disaggregation_age == 1 & analysis_disaggregation_sex == 0 & 
                            analysis_disaggregation_ethnicity == 0 & analysis_disaggregation_education == 0 &
                            analysis_disaggregation_profession == 0 & analysis_disaggregation_ses == 0 , "Age", 
                          if_else(analysis_disaggregation_age == 0 & analysis_disaggregation_sex == 1 & 
                            analysis_disaggregation_ethnicity == 0 & analysis_disaggregation_education == 0 &
                            analysis_disaggregation_profession == 0 & analysis_disaggregation_ses == 0 , "Sex",
                          if_else(analysis_disaggregation_age == 1 & analysis_disaggregation_sex == 1 & 
                            analysis_disaggregation_ethnicity == 0 & analysis_disaggregation_education == 0 &
                            analysis_disaggregation_profession == 0 & analysis_disaggregation_ses == 0 , "Age & Sex",
                          if_else(analysis_disaggregation_age == 1 & analysis_disaggregation_sex == 0 & (
                            analysis_disaggregation_ethnicity == 1 | analysis_disaggregation_education == 1 |
                            analysis_disaggregation_profession == 1 | analysis_disaggregation_ses == 1), "Age +1",
                          if_else(analysis_disaggregation_age == 0 & analysis_disaggregation_sex == 1 & (
                            analysis_disaggregation_ethnicity == 1 | analysis_disaggregation_education == 1 |
                            analysis_disaggregation_profession == 1 | analysis_disaggregation_ses == 1), "Sex +1",
                          if_else(analysis_disaggregation_age == 1 & analysis_disaggregation_sex == 1 & (
                            analysis_disaggregation_ethnicity == 1 | analysis_disaggregation_education == 1 |
                            analysis_disaggregation_profession == 1 | analysis_disaggregation_ses == 1), "Age & Sex +1",
                          if_else((analysis_disaggregation_age == 0 | analysis_disaggregation_sex == 0) & (
                            analysis_disaggregation_ethnicity == 1 | analysis_disaggregation_education == 1 |
                            analysis_disaggregation_profession == 1 | analysis_disaggregation_ses == 1), "Other demographics",
                            "No disaggregation", ))))))))

# Count the number of articles for each condition by year of publication
data.analysis <- data.analysis %>%
  count(report, article_year) %>%
  ungroup()

# Compute the proportion of articles per condition by year of publication
data.analysis <- data.analysis %>%
  group_by(article_year) %>%
  mutate(total=sum(n)) %>%
  group_by(report, add=TRUE) %>%
  mutate(per=round(100*n/total,2))

data.analysis$article_year <- as.numeric(data.analysis$article_year)
data.analysis$per <- as.numeric(data.analysis$per)

# Stacked bar chart of the use of demographic variables in the analysis by year of publication
figure8 <- ggplot(data.analysis, aes(x=article_year, y=per)) +
  geom_col(aes(fill=report)) +
  theme_apa() +
  xlab("Year of publication") +
  ylab("Percentage of articles") +
  labs(fill="Variable reported") +
  scale_fill_viridis_d() +
  scale_x_continuous(breaks=c(1979,1989,1999,2009,2019)) +
  scale_y_continuous(expand=c(0,0)) +
  theme(axis.title=element_text(face="bold", size=14), axis.text=element_text(colour="black", face="bold"), 
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8),
        legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,0,-10,-10))
```



# Results

### Inclusion & Exclusion 

  `r round(percent.included)`% of the sampled articles met eligibility criteria during the review.
  
```{r, fig.cap="Inclusion and exclusion of articles.", warning=FALSE, message=FALSE}
figure1B
```

### Funding

  Funding sources were reported by `r round(percent.funding.name)`% of studies, while funding number was also reported in `r round(percent.funding.num)`% of these cases. Overall, funding by the United States' National Institutes of Health (NIH) represented `r round(percent.funding.NI)`% of the reported funding agencies. `r round(percent.funding.NI.num)`% of the studies funded by the NIH also reported funding number. 


### Geographical location
  
  `r round(100-percent.country.multiple)`% of articles were conducted in a single country. The geographical location of the study was explicitly reported in `r round(percent.country.reported)`% of studies. The country of study was inferred for the rest of the sampled articles. Inference was primarily based on the first author's affiliation. Overall, `r nrow(country.single)` countries were represented. Figure 2B shows the distribution of study location across time with the eight most represented countries.
  
```{r, fig.cap="Geographical location of the studies. The eight most represented countries are individually shown.", warning=FALSE, message=FALSE}
figure2B
```

### Sample size

  Sample size was reported in `r round(percent.ss)`% of studies, while `r round(percent.study.single)`% investigated a single sampled population.

```{r, fig.cap="Sample size of the recruited volunteers. Numbers are computed with a log-10 scale.", warning=FALSE, message=FALSE}
figure3
```

### Age

  `r round(percent.age)`% of articles reported a variable describing age. Figure 4A and 4B show the use of various age variables by year and journal of publication. Overall, the mean age of the study populations was `r round(mean(data.age.mean$age_reported_mean_value))` years old.

```{r, warning=FALSE, message=FALSE}
figure4A
figure4B
```


```{r, fig.cap="Reporting of age variables. Correlation between the reporting of the mean, standrad deviation of the mean, median, minimum, maximum, interquartile range and other age variables by A. year of publication and B. journal of publication. C. Mean age by year of publication.", message=FALSE, warning=FALSE}
figure4C

#grid.arrange(figure4A, figure4C, figure4B, nrow=2)
```

### Sex

  Sex was reported in `r round(percent.sex)`% of the studies. Figure 5 displays the proportion of studies that recruited male subjects, female subjects, both sexes or did not specify the sex of the participants. `r round(percent.sex.male)`% of the studies reporting sex only recruited male participants, while `r round(percent.sex.female)`% only employed females. Out of the studies focusing on a single gender, `r round(percent.sex.male.focus)`% of the male studies focused on a sex dependent feature, while `r round(percent.sex.female.focus)`% of the female studies did. `r round(percent.sex.age)`% of studies reported age by sex. 
  

```{r, fig.cap="Sex inclusion. Proportion of studies that recruited male subjects, female subjects, both sexes, or did not specify the sex of the participants.", warning=FALSE, message=FALSE}
figure5A
```


###  Ethnicity, education, profession and socio-economic status

  Other demographics variables were reported in `r round(percent.education)`% of studies for education, `r round(percent.ethnicity)`% for ethnicity, `r round(percent.profession)`% for profession, and `r round(percent.ses)`% for socio-economic status. Figure 6 shows the distribution of this reporting across the years. Figures 7 show the number of categories reported for each variable. 


```{r, fig.cap="Reporting of education, ethinicity, profession and socio-economic status.", warning=FALSE, message=FALSE}
#figure6.bars
figure6.points
```
  

```{r, fig.cap="Number of categories reported for education, ethnicity, profession and socio-economic status.", warning=FALSE, message=FALSE}
grid.arrange(figure7A, figure7B, figure7C, figure7D, nrow=2)
```


### Study focus

  `r round(percent.focus.sex)`% of articles focused on a sex dependent feature, while `r round(percent.focus.clinical)`% investigated a clinical feature. `r round(percent.focus.twins)`% of studies focused on twins, `r round(percent.focus.pregnant)`% on pregnant women, `r round(percent.focus.shift)`% on shift workers and `r round(percent.focus.students)`% on university students. 


### Analysis disaggregation

  A
  
  
```{r, fig.cap="Use of study population characteristics as variables in the analysis."}
figure8
```



# Discussion


# Conclusion


\newpage

# References

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id="refs" custom-style="Bibliography"></div>
\endgroup
