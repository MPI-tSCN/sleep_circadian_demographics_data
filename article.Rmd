---
title             : "Inclusion, reporting and analysis of demographic variables in chronobiology and sleep research"
shorttitle        : "Study sample characteristics in chronobiology and sleep research"

author: 
  - name          : "Selma Tir"
    affiliation   : "1,2"
    email         : "selma.tir@ndcn.ox.ac.uk"
    role:
      - Data curation
      - Investigation
      - Software
      - Visualization
      - Writing – original draft
      - Writing – review & editing
  - name          : "Rhiannon White"
    affiliation   : "1,3"
    email         : "r.white.5@warwick.ac.uk"
    role:         
      - Investigation
      - Writing – original draft
      - Writing – review & editing
  - name          : "Manuel Spitschan"
    affiliation   : "1,4,5"
    corresponding : yes    # Define only one corresponding author
    email         : "manuel.spitschan@psy.ox.ac.uk"
    address       : Department of Experimental Psychology, University of Oxford, Anna Watts Building, Radcliffe Observatory Quarter, Woodstock Rd, Oxford, OX2 6GG, United Kingdom
    telephone     : +44 1865 281861
    role:
      - Conceptualization
      - Data curation
      - Funding acquisition
      - Investigation
      - Methodology
      - Project administration
      - Software
      - Writing – original draft
      - Writing – review & editing
      

affiliation:
  - id            : "1"
    institution   : "Department of Experimental Psychology, University of Oxford"
  - id            : "2"
    institution   : "Sleep and Circadian Neuroscience Institute, Nuffield Department of Clinical Neurosciences, University of Oxford"
  - id            : "3"
    institution   : "Warwick Medical School, University of Warwick, United Kingdom"
  - id            : "4"
    institution   : "Centre for Chronobiology, Psychiatric Hospital of the University of Basel, Switzerland"
  - id            : "5"
    institution   : "Transfaculty Research Platform Molecular and Cognitive Neurosciences, University of Basel, Switzerland"

authornote: |
 This work was funded by the Wellcome Trust (Sir Henry Wellcome Fellowship to MS 204686/Z/16/Z; Research Enrichment – Diversity & Inclusion WT 204686/Z/16/A) and Linacre College (Biomedical Sciences Junior Research Fellowship to MS).
abstract: |
  Many aspects of sleep and circadian physiology appear to be sensitive to participant-level characteristics. While recent research robustly highlights the importance of considering participant-level demographic information, it is not clear to what extent this information is available in the large body of already published literature. Here, we investigated study sample characteristics in the published sleep and chronobiology research over the past 40 years. 6,777 articles were identified and a random sample of 20% was included. The reporting of sample size, age, sex, gender, ethnicity, level of education, socio-economic status, and profession of the study population was scored, and any reported aggregate summary statistics for these variables were recorded. We found that while >90% of studies reported age or sex, all other variables were reported in <15% of cases. Sex balance greatly changed over the years, from a ~3:1 male to female ratio in the 1990s to a near-equal representation in the 2010s. We found that the majority of studies report at least sex or age, while other variables are typically not reported. Reporting quality is highly variable, indicating an opportunity to standardize reporting guidelines for participant-level characteristics to facilitate meta analyses.
  
keywords          : "demographics, ethnicity, sex, research participants, reporting, publishing, meta-science"
wordcount         : "3200"

bibliography      : references.bib
csl               : vancouver.csl

floatsintext      : yes
figurelist        : yes
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : no

documentclass     : "apa6"
classoption       : "jou"
output            : papaja::apa6_docx
---


```{r setup, include=FALSE}
# Version control
## R version 4.0.5 (2021-03-31)
## R Studio version 1.4.1106
## Microsoft Windows version 10.0.19041.329

# Load packages
library(papaja)
library(corrplot)
library(dplyr)
library(ggplot2)
library(ggthemes)
library(ggExtra)
library(ggsci)
library(graphics)
library(gridExtra)
library(knitr)
library(latticeExtra)
library(mosaic)
library(pracma)
library(readr)
library(readxl)
library(reshape2)
library(stats) 
library(stringr)
library(tibble)
library(tidyr)
library(lemon)

r_refs("references_r.bib")
```


```{r Data, include=FALSE}
## Download data sheet from Github repository
## Change path if needed 

# Set working directory
#setwd("~/Demographics Review")
setwd("~/Projects/sleep_circadian_demographics_data")

# Download scoring sheet 
data.original <- read_excel("data.xlsx")
```

# Summary

In this article, we addressed the question of how representative, diverse and inclusive published research articles in sleep and chronobiology are. We analyzed a sample of >1,300 articles published in sleep research and chronobiology journals between 1979 and 2019 for its inclusion, reporting analysis of demographic variables of study participants, including age, sex, gender, ethnicity, level of education, socio-economic status, and profession.  We found that while >90% of studies reported age or sex, all other variables were reported in <10% of cases, with the frequency of reporting changing over time. We identify opportunities for improving the reporting of demographic variables.

# Research Agenda

Future research needs to identify:
1. Schemas for reporting demographic variables in a harmonized way across geographical and cultural contexts;
2. Gaps in the sleep and chronobiology literature with respect to understudied populations;
3. Understand the extent to which research practices run counter the inclusion of diverse populations in research in all stages of the research cycle, and how this can exacerbate health inequities.

# Practice Points

1. Published studies on circadian and sleep physiology should be carefully examined.
1. Reporting of demographic variables should be done carefully and systematically.
2. Inclusion and diversity of different populations across the field needs to be ensured.


# Introduction 

There are large individual differences in sleep and circadian physiology [@van_dongen_individual_2005; @kerkhof_inter-individual_1985; @tankova_circadian_1994; @horne_individual_1977; @baehr_individual_2000; @burgess_individual_2008; @santhi_spectral_2012; @chellappa_individual_2021], demonstrating the need to consider sleep and circadian physiology at a participant-level. Some of these characteristics are systematically related to demographic variables, most notably sex [@redline_effects_2004; @santhi_sex_2016; @cain_sex_2010; @anderson_sexual_2020; @mong_sleep_2011], age [@redline_effects_2004; @espiritu_aging-related_2008; @mander_sleep_2017; @desforges_sleep_1990; @li_sleep_2018; @bliwise_sleep_1993; @benloucif_responsiveness_2006; @duffy_aging_2015] and ethnicity [@ahn_scoping_2021; @goldstein_sleep_2020; @eastman_blacks_2012; @eastman_circadian_2016]. Zooming out from the level of individual studies, there are significant inequities in sleep health depending on ethnicity and socio-economic status [@jackson_sleep_2020; @jackson_racialethnic_2020; @williams_racialethnic_2015; @jackson_workshop_2020; @jean-louis_importance_2016; @laposky_reducing_2016]. As compromised sleep has many knock-on effects, including negative effects on cardiovascular, metabolic, neurobehavioral and cognitive function, it is a key imperative to understand how demographic variables influence sleep and circadian rhythms.

The extent to which a scientific field's findings are generalizable is a function of the representativeness of a given study sample, and the degree to which findings differ between, e.g., different sexes and ethnicity. In the domain of sex, a recent study reviewed the reporting and analysis of sex in biological sciences research [@woitowich_10-year_2020]. The authors found that while sex inclusion has significantly increased over the past 10 years [@beery_sex_2011], sex-based analysis has not improved, despite recent policies and funder mandates [@clayton_policy_2014]. The term "gender data gap" has recently been introduced, demonstrating that women have historically been excluded from biomedical research [@criado-perez_invisible_2020]. Similarly, the lack of diversity in biomedical and clinical research, and understudy of minorities in the presence of existing health inequities exacerbates these inequities [@oh_diversity_2015].

While research findings converge on participant-level demographic characteristics affecting outcomes, it is not clear to what extent this information is available in the large body of already published literature, nor to what extent it is even reported. Here, we address the question of participant-level demographic characteristics (age, sex, gender, ethnicity, level of education, socio-economic status, and profession of the study population) and reporting thereof in chronobiology and sleep research. We extracted the study sample characteristics in a total of 1355 randomly sampled publications across the 8 top (ranked by the Journal Impact Factor) chronobiology and sleep research and subjected them to a comprehensive analysis in terms of the inclusion, reporting and analysis of demographic variables.

# Methods
  
## Procedure

Journal articles published between 1979 and 2019 (odd years) in the top eight sleep and chronobiology journals were considered. The list of possible target journals was based on a previously established list of journals implementing a hybrid strategy by consulting the Web of Science Master Journal List, domain-relevant expertise in sleep and chronobiology and consulting with a senior researcher with >25 years of experience in the field [@spitschan_transparency_2020]. From this previously derived list, we selected eight journals based on their five-year Impact Factor, and included *Journal of Pineal Research* (ISSN: 0742-3098 / 1600-079X; 2018 5-year IF: 12.197), *Sleep*  (0161-8105 / 1550-9109; 5.588), *Journal of Sleep Research* (0962-1105 / 1365-2869; 3.951), *Sleep Medicine* (1389-9457 / 1878-5506; 3.934), *Journal of Clinical Sleep Medicine* (1550-9389 / 1550-9397; 3.855), *Journal of Biological Rhythms* (0748-7304 / 1552-4531; 3.349), Behavioral Sleep Medicine (1540-2002 / 1540-2010; 3.162), and *Chronobiology International* (0742-0528 / 1525-6073; 2.998). While *Sleep Medicine Reviews* also features in the list of journals, we did not include it as it primarily publishes reviews.

## Article inclusion

6,777 articles were identified through a MEDLINE search and filtering by journal and odd years. A random sample of 20% was initially selected for screening. Inclusion requirements included conducting original research in the English language, reporting human data, and recruiting volunteers. As such, animal studies, bibliographies, case reports, comments, conference proceedings, editorials, guidelines, letters, retracted publications, reviews, errata and corrigenda were excluded.

## Review and article extraction

All included articles were reviewed for eligibility and coded by RW. The reporting of sample size, age, sex, gender, ethnicity, level of education, socio-economic status, and profession of the study population was scored binarily (0 = not reported, 1 = reported), and any reported aggregate summary statistics for these variables were recorded. Funding source, geographical location and clinical focus of the article were examined, as well as whether data were analyzed by including any of the demographic variables as covariates. Data were coded in an Excel Spreadsheet and analyzed in R Studio (version 4.0.5). Reporting of funding, geographical location, and number of sub-studies for each article were investigated for the sample of articles that passed all eligibility criteria.

```{r Inclusion & Exclusion, echo=FALSE, message=FALSE, warning=FALSE}
# Filter reviewed articles
data.original <- data.original %>%
  filter(article_fulltext_available_yn == 1)

# Compute total number of reviewed articles
n.original <- as.numeric(nrow(data.original))

# Separate included and excluded articles
data.included <- data.original %>%
  filter(article_included_yn == 1)

data.excluded <- data.original %>%
  filter(article_included_yn == 0)

# Check number of included and excluded articles is equal to total (return TRUE if yes)
check.inclusion <- (as.numeric(nrow(data.included)) + as.numeric(nrow(data.excluded))) == as.numeric(nrow(data.original))

# Compute percentage of included vs excluded articles, round to two decimals
percent.included <- round(as.numeric(nrow(data.included))/as.numeric(nrow(data.original)) * 100, 2)
percent.excluded <- round(as.numeric(nrow(data.excluded))/as.numeric(nrow(data.original)) * 100, 2)

# Stacked bar chart of included articles by journal and year of publication
figure1 <- ggplot(data.included, aes(x=article_year)) +
  geom_bar(stat="count", aes(fill=article_journal)) +
  theme_apa() +
  xlab("Year of publication") +
  ylab("Number of included articles") +
  labs(fill="Journal") +
  ggtitle("Included and analysed articles by journal and year") +
  scale_x_continuous(breaks=c(1979,1989,1999,2009,2019)) +
  scale_y_continuous(expand=c(0,0)) +
  scale_fill_viridis_d() +
  theme(axis.title=element_text(face="bold", size=12), 
        axis.text=element_text(colour="black", face="bold"), 
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8),
        legend.title=element_text(face="bold", size=12), legend.margin=margin(0,0,0,0),
        legend.box.margin=margin(-10,0,-10,-10))

# Compute percentage of articles excluded for other reasons
data.excluded.other <- data.excluded %>%
  filter(!is.na(article_excluded_reason_other))
percent.excluded.other <- round(nrow(data.excluded.other)/nrow(data.excluded) * 100, 2)

# Compute percentage of excluded articles by reason for exclusion
data.eligibility <- data.original
data.eligibility$article_excluded_reason <- tolower(data.eligibility$article_excluded_reason) 
data.eligibility <- data.eligibility %>%
  mutate(eligibility=if_else(!is.na(article_excluded_reason_other), "Not included for other reasons", 
                          if_else(article_included_yn == 1, "Included",
                                  if_else(article_excluded_reason == "not recruiting volunteers", 
                                          "Not recruiting volunteers",
                                          if_else(article_excluded_reason == "not an original research article",
                                                  "Not an original research article",
                                                  if_else(article_excluded_reason == "not reporting human data",
                                                          "Not reporting human data",
                                                          "NA"))))))

data.eligibility <- data.eligibility %>%
  count(eligibility, article_year) %>%
  ungroup()

data.eligibility <- data.eligibility %>%
  group_by(article_year) %>%
  mutate(total=sum(n)) %>%
  group_by(eligibility) %>%
  mutate(per=round(100*n/total,3))

data.eligibility$article_year <- as.numeric(data.eligibility$article_year)
data.eligibility$per <- as.numeric(data.eligibility$per)

# Stacked bar chart of excluded articles by reason for exclusion and year of publication
figure2 <- ggplot(data.eligibility, aes(x=article_year, y=per)) +
  geom_col(aes(fill=factor(eligibility, levels=c("Not an original research article",
                                                 "Not reporting human data",
                                                 "Not included for other reasons",
                                                 "Not recruiting volunteers",
                                                 "Included")))) +
  theme_apa() +
  xlab("Year of publication") +
  ylab("Proportion of articles") +
  labs(fill="Eligibility") +
  ggtitle("Inclusion and reasons for exclusion") +
  scale_x_continuous(breaks=c(1979,1989,1999,2009,2019)) +
  scale_y_continuous(labels=c("0%","25%","50%","75%","100%"), expand=c(0,0)) +
  scale_fill_manual(values=c("#29AF7FFF","#2D708EFF","#D8DE29FF","#482677FF")) +
  theme(axis.title=element_text(face="bold", size=12), 
        axis.text=element_text(colour="black", face="bold"), 
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8),
        legend.title=element_text(face="bold", size=12), legend.margin=margin(0,0,0,0),
        legend.box.margin=margin(-10,0,-10,-10))
```

## Pre-registration

We pre-registered our protocol (specified using the PRISMA-P template [@shamseer_preferred_2015; @prisma-p_group_preferred_2015]) on the Open Science Framework (https://osf.io/cu3we/).

## Materials, data and code availability

All data underlying this manuscript are available on a public GitHub repository (https://github.com/hcvnl/sleep_circadian_demographics_data). The article was written in R [@R-base] using RMarkdown and papaja [@R-papaja], employing a series of additional R packages [@R-corrplot2017; @R-dplyr; @R-ggExtra; @R-ggformula; @R-ggplot2; @R-ggridges; @R-ggsci; @R-ggstance; @R-ggthemes; @R-gridExtra; @R-knitr; @R-lattice; @R-latticeExtra; @R-lemon; @R-Matrix; @R-mosaic; @R-mosaicData; @R-pracma; @R-readr; @R-readxl; @R-reshape2; @R-stringr; @R-tibble; @R-tidyr] and is fully reproducible.

```{r Funding, include=FALSE}
# Select articles that report funding
data.funding.name <- data.included %>%
  filter(funding_reported_yn == 1)

# Compute percentage of articles that report funding
percent.funding.name <- round(nrow(data.funding.name)/as.numeric(nrow(data.included)) * 100, 2)

# Select articles that report funding number
data.funding.num <- data.included %>%
  filter(funding_refnum_yn == 1)

# Compute percentage of articles that report funding number, out of those that report funding
percent.funding.num <- round(nrow(data.funding.num)/as.numeric(nrow(data.funding.name)) * 100, 2)

# Compute whether articles report funding and funding number
data.funding <- data.included %>%
  mutate(funding=if_else(!is.na(funding_names) & funding_refnum_yn==0, 
                         "Funding reported", 
                         if_else(!is.na(funding_names) & funding_refnum_yn==1, 
                                 "Funding and grant reported", 
                                 "Funding not reported")))

data.funding$funding <- as.factor(data.funding$funding)

# Count number of articles for funding condition by year of publication
data.funding <- data.funding %>%
  count(funding, article_year) %>%
  ungroup()

# Compute proportion of articles per sex category by year of publication
data.funding <- data.funding %>%
  group_by(article_year) %>%
  mutate(total=sum(n)) %>%
  group_by(funding, add=TRUE) %>%
  mutate(per=round(100*n/total,3))
data.funding$article_year <- as.numeric(data.funding$article_year)
data.funding$per <- as.numeric(data.funding$per)

# Stacked bar chart of reporting of funding and funding number by year of publication
figure3 <- ggplot(data.funding, aes(x=article_year, y=per)) +
  geom_col(aes(fill=factor(funding, levels=c("Funding not reported",
                                            "Funding reported",
                                            "Funding and grant reported")))) +
  theme_apa() +
  xlab("Year of publication") +
  ylab("Proportion of articles") +
  ggtitle("Funding reporting") +
  labs(fill="") +
  scale_fill_manual(values=c("#482677FF","#DCE319FF","#FDE725FF")) +
  scale_x_continuous(breaks=c(1979,1989,1999,2009,2019)) +
  scale_y_continuous(labels=c("0%","25%","50%","75%","100%"), expand=c(0,0)) +
  theme(axis.title=element_text(face="bold", size=12), 
        axis.text=element_text(colour="black", face="bold"), 
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8),
        legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,0,-10,-10))

# Change funding names to lower case
data.funding.name$funding_names <- tolower(data.funding.name$funding_names)

# Create list of funding sources
list.funding <- data.funding.name$funding_names

# Split combinations of funding sources (multiple funding names)
# which are delimited by commas
list.funding <- as.list(strsplit(list.funding, ","))
list.funding <- unlist(list.funding)

# Count number of occurrences for each funding name
table.list.funding <- as.data.frame(table(list.funding))

# Combine funding names that fall under the same agency
table.list.funding$list.funding <- as.character(table.list.funding$list.funding)

# NIH (USA)
table.list.funding <- table.list.funding %>%
  mutate(list.funding=if_else(grepl("nih", table.list.funding$list.funding)== TRUE | grepl("national institute", table.list.funding$list.funding) == TRUE | grepl("nimh", table.list.funding$list.funding)== TRUE | grepl("nhlbi", table.list.funding$list.funding)== TRUE | grepl("national heart lung", table.list.funding$list.funding)== TRUE | grepl("national cancer institute", table.list.funding$list.funding)== TRUE | grepl("nia", table.list.funding$list.funding)== TRUE | grepl("ninds", table.list.funding$list.funding)== TRUE | grepl("ninr", table.list.funding$list.funding)== TRUE | grepl("ninda", table.list.funding$list.funding)== TRUE, 
                              "NI", table.list.funding$list.funding))
# NHMRC (AUS)
table.list.funding <- table.list.funding %>%
  mutate(list.funding=if_else(grepl("nhmrc", table.list.funding$list.funding)== TRUE | grepl("national health and medical research council", table.list.funding$list.funding)== TRUE,
                              "NHMRC", table.list.funding$list.funding)) 

# Wellcome Trust (GBR)
table.list.funding <- table.list.funding %>%
  mutate(list.funding=if_else(grepl("wellcome", table.list.funding$list.funding)== TRUE,
                              "Wellcome Trust", table.list.funding$list.funding)) 

# CIHR (CAN)
table.list.funding <- table.list.funding %>%
  mutate(list.funding=if_else(grepl("canadian institute", table.list.funding$list.funding)== TRUE,
                              "CIHR", table.list.funding$list.funding)) 

# NSFC (CHN)
table.list.funding <- table.list.funding %>%
  mutate(list.funding=if_else(grepl("national natural science", table.list.funding$list.funding)== TRUE,
                              "NSFC", table.list.funding$list.funding)) 

# Academy of Finland (FIN)
table.list.funding <- table.list.funding %>%
  mutate(list.funding=if_else(grepl("academy of finland", table.list.funding$list.funding)== TRUE,
                              "Academy of Finland", table.list.funding$list.funding))

# Inserm (FRA)
table.list.funding <- table.list.funding %>%
  mutate(list.funding=if_else(grepl("inserm", table.list.funding$list.funding)== TRUE,
                              "Inserm", table.list.funding$list.funding)) 

# SNSF (CHE)
table.list.funding <- table.list.funding %>%
  mutate(list.funding=if_else(grepl("swiss national", table.list.funding$list.funding)== TRUE,
                              "SNSF", table.list.funding$list.funding)) 

# Department of Veterans Affairs (USA)
table.list.funding <- table.list.funding %>%
  mutate(list.funding=if_else(grepl("veterans affairs", table.list.funding$list.funding)== TRUE,
                              "Dept Vet Affairs", table.list.funding$list.funding)) 

# European Commission
table.list.funding <- table.list.funding %>%
  mutate(list.funding=if_else(grepl("european commission", table.list.funding$list.funding)== TRUE,
                              "EC", table.list.funding$list.funding)) 

# Group by funding agency
table.list.funding <- table.list.funding %>%
  group_by(list.funding) %>%
  summarise(N = sum(Freq))

# Compute percentage of articles that report funding from the National Institutes in the US
data.funding.NI <- data.funding.name %>%
  filter(grepl("nih", funding_names) | grepl("national institute", funding_names) | grepl("nimh", funding_names) | grepl("nhlbi", funding_names) | grepl("national heart lung", funding_names) | grepl("national cancer institute", funding_names) | grepl("nia", funding_names) | grepl("ninr", funding_names) | grepl("ninda", funding_names) | grepl("ninds", funding_names))

percent.funding.NI <- round(nrow(data.funding.NI)/as.numeric(nrow(data.included)) * 100, 2)

# Select articles that report funding number and funding from National Institutes in the US
data.funding.NI.num <- data.funding.NI %>%
  filter(funding_refnum_yn == 1)

percent.funding.NI.num <- round(nrow(data.funding.NI.num)/as.numeric(nrow(data.funding.NI)) * 100, 2)
```

```{r Study Country, echo=FALSE, message=FALSE, warning=FALSE}
# Set country code to upper case
data.included$study_country_values <- toupper(data.included$study_country_values)

# Separate articles for which country is reported explicitly vs inferred
data.country.reported <- data.included %>%
  filter(study_country_reported_explicitly_yn == 1)

data.country.inferred <- data.included %>%
  filter(study_country_reported_inferred_yn == 1)

# Compute percentage of articles where country is reported explicitly vs inferred
percent.country.reported <- round(nrow(data.country.reported)/nrow(data.included) * 100, 2)
percent.country.inferred <- round(nrow(data.country.inferred)/nrow(data.included) * 100, 2)

# Separate articles that report one or multiple countries of study
# Compute percentage of articles per study country
country.single <- data.included %>%
  filter(!grepl(",", study_country_values)) %>%
  group_by(study_country_values) %>%
  tally() %>%
  mutate(n=round((n/as.numeric(nrow(data.included))*100),1))

country.multiple <- data.included %>%
  filter(grepl(",", study_country_values)) %>%
  group_by(study_country_values) %>%
  tally() %>%
  mutate(n=round((n/as.numeric(nrow(data.included))*100),1))

# Compute percentage of articles where multiple countries of study are reported
percent.country.multiple <- round(nrow(country.multiple)/nrow(data.included) * 100, 2)

# Compute number of articles for the 8 most represented countries by year of publication
# Check in dataset "country.single" which countries are the 8 most represented

# Select articles where a single country is reported or inferred
data.country <- data.included %>%
  filter(!grepl(",", study_country_values)) %>%
  count(study_country_values, article_year) %>%
  ungroup()

# Change all countries that are not the 8 most represented countries to 'Other'
data.country$study_country_values[data.country$study_country_values != "AUS" &
                                    data.country$study_country_values != "CAN" &
                                    data.country$study_country_values != "DEU" &
                                    data.country$study_country_values != "FRA" &
                                    data.country$study_country_values != "GBR" &
                                    data.country$study_country_values != "USA" &
                                    data.country$study_country_values != "ITA" &
                                    data.country$study_country_values != "JPN"] <- "Other"

# Sum rows with 'Other' by year
data.country <- aggregate(cbind(n) ~ study_country_values + article_year, data=data.country, FUN=sum)

# Compute proportion of articles per country by year of publication
data.country <- data.country %>%
  group_by(article_year) %>%
  mutate(total=sum(n)) %>%
  group_by(study_country_values) %>%
  mutate(per=round(100*n/total,3))
data.country$article_year <- as.numeric(data.country$article_year)
data.country$per <- as.numeric(data.country$per)

# Stacked bar chart of 8 most represented study countries by year of publication
figure4 <- ggplot(data.country, aes(x=article_year, y=per)) +
  geom_col(aes(fill=factor(study_country_values, 
                           levels=c("Other","AUS","CAN","DEU","FRA",
                                    "GBR","ITA","JPN","USA")))) +
  theme_apa() +
  xlab("Year of publication") +
  ylab("Proportion of articles") +
  ggtitle("Geographical location of included articles") +
  labs(fill="Country") +
  scale_x_continuous(breaks=c(1979,1989,1999,2009,2019)) +
  scale_y_continuous(labels=c("0%","25%","50%","75%","100%"), expand=c(0,0)) +
  scale_fill_viridis_d(direction=-1) +
  theme(axis.title=element_text(face="bold", size=12), 
        axis.text=element_text(colour="black", face="bold"), 
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8),
        legend.title=element_text(face="bold", size=12), legend.margin=margin(0,0,0,0),
        legend.box.margin=margin(-10,0,-10,-10))
```

```{r Number of sub-studies, echo=FALSE, message=FALSE, warning=FALSE}
# Compute percentage of articles per number of sub-studies
num.study <- data.included %>%
  group_by(num_substudies) %>%
  tally() %>%
  mutate(num_substudies=as.factor(num_substudies),
         n=round((n/as.numeric(nrow(data.included))*100),1))
percent.study.single <- num.study$n[1]
percent.study.multiple <- 1 - num.study$n[1]

## The rest  of the analysis will be conducted on included single studies
# Filter single studies
data <- data.included %>%
  filter(num_substudies == 1)
```

```{r Sample size, echo=FALSE, message=FALSE, warning=FALSE}
# Compute percentage of studies that report sample size
data.ss <- data %>%
  filter(sample_size_bycategory_reported_yn == 1)
percent.ss <- round(nrow(data.ss)/nrow(data) * 100, 2)

# Violin plot of sample size by year of publication with log10 scaling
data.ss$article_year <- as.factor(data.ss$article_year)
data.ss$sample_size_total_reported_values <- as.numeric(data.ss$sample_size_total_reported_values)

figure5 <- ggplot(data.ss, aes(x=article_year, y=sample_size_total_reported_values)) +
  geom_violin(fill="#440154FF") +
  theme_apa() +
  scale_y_continuous(trans='log10', breaks=c(10,1000,100000), 
                     labels=c("10","1,000","100,000")) +
  scale_x_discrete(breaks=c("1979","1989","1999","2009","2019")) +
  xlab("Year of publication") +
  ylab("Sample size, log-10 scaling") +
  ggtitle("Evolution of sample size") +
  annotation_logticks(sides="l") +
  theme(axis.title=element_text(face="bold", size=12), 
        axis.text=element_text(colour="black", face="bold"), 
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8))
```

```{r Age, message=FALSE, warning=FALSE, include=FALSE}
# Select articles reporting age
data.age <- data %>%
  filter(age_reported_mean_yn == 1 | age_reported_median_yn == 1 | age_reported_min_yn | age_reported_max_yn | age_reported_other_yn == 1 | age_reported_by_sex_yn == 1)

# Compute percentage of articles reporting age
percent.age <- round(nrow(data.age)/nrow(data) * 100, 2)

## Correlate reporting of age variables by year
# select year and age columns
data.age.year <- data.age %>%
  select(article_year, age_reported_mean_yn, age_reported_sd_yn, age_reported_median_yn, 
         age_reported_min_yn, age_reported_max_yn, age_reported_iqr_yn, age_reported_other_yn)

# Replace 0 by -1
data.age.year$age_reported_mean_yn[data.age.year$age_reported_mean_yn == 0] <- -1
data.age.year$age_reported_sd_yn[data.age.year$age_reported_sd_yn == 0] <- -1
data.age.year$age_reported_median_yn[data.age.year$age_reported_median_yn == 0] <- -1
data.age.year$age_reported_min_yn[data.age.year$age_reported_min_yn == 0] <- -1
data.age.year$age_reported_max_yn[data.age.year$age_reported_max_yn == 0] <- -1
data.age.year$age_reported_iqr_yn[data.age.year$age_reported_iqr_yn == 0] <- -1
data.age.year$age_reported_other_yn[data.age.year$age_reported_other_yn == 0] <- -1

# Replace NAs
data.age.year[is.na(data.age.year)] <- -1

# Group by year and compute average for each sex variable
age.corr.year <- data.age.year %>%
  group_by(article_year) %>%
  summarise(mean=mean(age_reported_mean_yn), 
            sd=mean(age_reported_sd_yn), median=mean(age_reported_median_yn),
            min=mean(age_reported_min_yn), max=mean(age_reported_max_yn),
            iqr=mean(age_reported_iqr_yn),
            other=mean(age_reported_other_yn))  %>%
  ungroup()

age.corr.year <- age.corr.year %>%
  group_by(article_year) %>%
  mutate(total=((mean+sd+median+min+max+iqr+other)/7))

# Reshape data
age.corr.year <- melt(age.corr.year,id.vars='article_year',
                      measure.vars=c('mean','sd','median','min',
                                     'max','iqr','other','total'))

# Heat map of reporting of age variables by year of publication
figure6 <- ggplot(data=age.corr.year, aes(x=variable, y=article_year, fill=value)) +
  geom_tile() +
  theme_apa() +
  ylab(label="Year of publication") +
  xlab("Age variable") +
  ggtitle("Age reporting by year") +
  scale_y_continuous(breaks=c(1979,1989,1999,2009,2019), expand=c(0.02,0),
                     labels=c("                   1979", "1989","1999","2009","2019")) +
  scale_fill_viridis_c(end=0.6, direction=-1, name="Reporting",
                       limits=c(-1,1), labels=c("0.0","0.25","0.5","0.75","1")) +
  theme(axis.title=element_text(face="bold", size=12), 
        axis.text=element_text(colour="black", face="bold"), 
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8), 
        legend.position="right", legend.margin=margin(0,0,0,0),
        legend.box.margin=margin(-10,0,-10,-10), legend.title=element_text(face="bold"))

## Correlate reporting of age variables by journal
# Select journal and age columns
data.age.journal <- data.age %>%
  select(article_journal, age_reported_mean_yn, age_reported_sd_yn, age_reported_median_yn, 
         age_reported_min_yn, age_reported_max_yn, age_reported_iqr_yn, age_reported_other_yn)

# Replace 0 by -1
data.age.journal$age_reported_mean_yn[data.age.journal$age_reported_mean_yn == 0] <- -1
data.age.journal$age_reported_sd_yn[data.age.journal$age_reported_sd_yn == 0] <- -1
data.age.journal$age_reported_median_yn[data.age.journal$age_reported_median_yn == 0] <- -1
data.age.journal$age_reported_min_yn[data.age.journal$age_reported_min_yn == 0] <- -1
data.age.journal$age_reported_max_yn[data.age.journal$age_reported_max_yn == 0] <- -1
data.age.journal$age_reported_iqr_yn[data.age.journal$age_reported_iqr_yn == 0] <- -1
data.age.journal$age_reported_other_yn[data.age.journal$age_reported_other_yn == 0] <- -1

# Replace NAs
data.age.journal[is.na(data.age.journal)] <- -1

# Group by journal and compute average for each sex variable
age.corr.journal <- data.age.journal %>%
  group_by(article_journal) %>%
  summarise(mean=mean(age_reported_mean_yn), sd=mean(age_reported_sd_yn),
            median=mean(age_reported_median_yn),min=mean(age_reported_min_yn),
            max=mean(age_reported_max_yn), iqr=mean(age_reported_iqr_yn),
            other=mean(age_reported_other_yn)) %>%
  ungroup()

age.corr.journal <- age.corr.journal %>%
  group_by(article_journal) %>%
  mutate(total=((mean+sd+median+min+max+iqr+other)/7))

# Reshape data
age.corr.journal <- melt(age.corr.journal,id.vars='article_journal',
                         measure.vars=c('mean','sd','median','min',
                                        'max','iqr','other','total'))

# Heat map of reporting of age variables by journal of publication
figure7 <- ggplot(data=age.corr.journal, 
                   aes(x=variable, y=article_journal, fill=value)) +
  geom_tile() +
  theme_apa() +
  ylab(label="Journal of publication") +
  xlab("Age variable") +
  ggtitle("Age reporting by journal") +
  scale_fill_viridis_c(end=0.6, direction=-1, name="Reporting",
                       limits=c(-1,1), labels=c("0.0","0.25","0.5","0.75","1")) +
  theme(axis.title=element_text(face="bold", size=12), 
        axis.text=element_text(colour="black", face="bold"), 
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8),
        legend.position="right", legend.margin=margin(0,0,0,0),
        legend.box.margin=margin(-10,0,-10,-10), legend.title=element_text(face="bold"))

## Regression for age by year of publication
# filter articles that report mean age in years
data.age.mean <- data.age %>%
  filter(age_reported_mean_yn == 1) %>%
  filter(!is.na(as.numeric(age_reported_mean_value))) %>%
  select(article_pmid, article_year, age_reported_mean_value)

# filter articles that report mean age in weeks or months
data.age.mean.not.years <- data.age %>%
  filter(age_reported_mean_yn == 1) %>%
  filter(is.na(as.numeric(age_reported_mean_value))) %>%
  select(article_pmid, article_year, age_reported_mean_value)

# Change age from days / weeks / months to years, with 1 month = 4.3 weeks = 30.4 days
# age not in years is entered with "months" or "weeks"
data.age.mean.not.years <- data.age.mean.not.years %>%
  separate(age_reported_mean_value, 
           into=c("age_reported_mean_value", "text"),
           sep=" ")
data.age.mean.not.years$age_reported_mean_value <- as.numeric(data.age.mean.not.years$age_reported_mean_value)

data.age.mean.not.years <- data.age.mean.not.years %>%
  mutate(age_reported_mean_value=ifelse(text=="weeks", 
                                        age_reported_mean_value / 4.3 / 12,
                                        if_else(text=="days",
                                                age_reported_mean_value / 30.4 / 12,
                                                age_reported_mean_value / 12))) %>%
  select(article_pmid, article_year, age_reported_mean_value)# else case is in months

# Merge back mean age datasets
data.age.mean <- rbind(data.age.mean, data.age.mean.not.years)

data.age.mean$age_reported_mean_value <- as.numeric(data.age.mean$age_reported_mean_value)

# Check regression statistics
summary(lm(age_reported_mean_value ~ article_year, data=data.age.mean))

# Violin plot with regression line and equation for mean age by year of publication
figure8 <- ggplot(data=data.age.mean, aes(x=article_year, y=age_reported_mean_value)) +
  geom_smooth(method="lm", color="#440154FF") +
  geom_point(size=1, color="#33638DFF") +
  theme_apa() +
  ylab("Mean age (years)") +
  xlab("Year of publication") +
  ggtitle("Evolution of mean age by year") +
  scale_x_continuous(limits=c(1979,2019),breaks=c(1979,1989,1999,2009,2019)) +
  scale_y_continuous(limits=c(0,80), expand=c(0,0)) +
  theme(axis.title=element_text(face="bold", size=12), 
        axis.text=element_text(colour="black", face="bold"), 
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8))
```


```{r Sex, echo=FALSE, message=FALSE, warning=FALSE}
# Select sex variables       
data.sex <- data %>%
  select(article_year, sex_reported_yn,
         sex_reported_num_male, sex_reported_percent_male,
         sex_reported_num_female,sex_reported_percent_female)

# Compute whether males or females are reported at all
data.sex$male <- ifelse(is.na(data.sex$sex_reported_num_male) & is.na(data.sex$sex_reported_percent_male),
                             "No",
                             "Yes")
data.sex$male <- as.factor(data.sex$male)

data.sex$female <- ifelse(is.na(data.sex$sex_reported_num_female) & is.na(data.sex$sex_reported_percent_female),
                             "No",
                             "Yes")
data.sex$female <- as.factor(data.sex$female)

# Compute whether articles report males, females, both or unspecified
data.sex <- data.sex %>%
  mutate(report=if_else(male == "Yes" & female == "Yes", "Both sexes", 
                          if_else(male == "Yes" & female == "No", "Male",
                                  if_else(male == "No" & female == "Yes", "Female", "Unspecified"))))


# Count number of articles for each sex condition by year of publication
data.sex <- data.sex %>%
  count(report, article_year) %>%
  ungroup()

# Compute proportion of articles per sex category by year of publication
data.sex <- data.sex %>%
  group_by(article_year) %>%
  mutate(total=sum(n)) %>%
  group_by(report, add=TRUE) %>%
  mutate(per=round(100*n/total,3))
data.sex$article_year <- as.numeric(data.sex$article_year)
data.sex$per <- as.numeric(data.sex$per)

# Stacked bar chart of sex reporting by year of publication
figure9 <- ggplot(data.sex, aes(x=article_year, y=per)) +
  geom_col(aes(fill=factor(report, levels=c("Unspecified",
                                            "Female",
                                            "Both sexes",
                                            "Male")))) +
  theme_apa() +
  xlab("Year of publication") +
  ylab("Proportion of articles") +
  ggtitle("Sex inclusion by year") +
  labs(fill="Sex") +
  scale_fill_manual(values=c("#482677FF","#D8DE29FF","#29AF7FFF","#2D708EFF")) +
  scale_x_continuous(breaks=c(1979,1989,1999,2009,2019)) +
  scale_y_continuous(labels=c("0%","25%","50%","75%","100%"), expand=c(0,0)) +
  theme(axis.title=element_text(face="bold", size=12), 
        axis.text=element_text(colour="black", face="bold"), 
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8),
        legend.title=element_text(face="bold"),
        legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,0,-10,-10)) 
  
# Select articles for which sex is reported
data.sex.reported <- data %>%
  filter(sex_reported_yn == 1) %>%
  mutate(sample_size_total_reported_values=as.numeric(sample_size_total_reported_values),
         sex_reported_num_male=as.numeric(sex_reported_num_male),
         sex_reported_percent_male=as.numeric(sex_reported_percent_male),
         sex_reported_num_female=as.numeric(sex_reported_num_female),
         sex_reported_percent_female=as.numeric(sex_reported_percent_female))

# Select articles for which intersex is reported
data.intersex <- data %>%
  filter(sex_reported_intersex_yn == 1)

# compute percentage of articles where sex and intersex is reported
percent.sex <- round(nrow(data.sex.reported)/nrow(data) * 100, 2)
percent.intersex <- round(nrow(data.intersex)/nrow(data) * 100, 2)

# Compute whether males or females are recruited in the articles that report  sex
data.sex.reported$male <- ifelse(is.na(data.sex.reported$sex_reported_num_male) &
                                   is.na(data.sex.reported$sex_reported_percent_male),
                             "No",
                             "Yes")
data.sex.reported$male <- as.factor(data.sex.reported$male)

data.sex.reported$female <- ifelse(is.na(data.sex.reported$sex_reported_num_female) &
                                     is.na(data.sex.reported$sex_reported_percent_female),
                             "No",
                             "Yes")
data.sex.reported$female <- as.factor(data.sex.reported$female)

# Compute whether articles report males, females or both
data.sex.reported <- data.sex.reported %>%
  mutate(report=if_else(male == "Yes" & female == "Yes", "Both Sexes", 
                          if_else(male == "Yes" & female == "No", "Male",
                                  if_else(male == "No" & female == "Yes", "Female", "NA"))))

# Compute percentage of articles that only recruit males or females
data.sex.male <- data.sex.reported %>%
  filter(report=="Male")
percent.sex.male <- round(nrow(data.sex.male)/nrow(data.sex.reported) * 100, 2)

data.sex.female <- data.sex.reported %>%
  filter(report=="Female")
percent.sex.female <- round(nrow(data.sex.female)/nrow(data.sex.reported) * 100, 2)

# Compute percentage of articles reporting on a sex-dependent feature
data.sex.male.focus <- data.sex.male %>%
  filter(sample_focus_sex_dependent_yn == 1)
percent.sex.male.focus <- round(nrow(data.sex.male.focus)/nrow(data.sex.male) * 100, 2)

data.sex.female.focus <- data.sex.female %>%
  filter(sample_focus_sex_dependent_yn == 1)
percent.sex.female.focus <- round(nrow(data.sex.female.focus)/nrow(data.sex.female) * 100, 2)

# Compute percentage of studies reporting age by sex
data.sex.age <- data %>%
  filter(age_reported_by_sex_yn == 1)
percent.sex.age <- round(nrow(data.sex.age)/nrow(data) * 100, 2)
```

```{r Other demographics, echo=FALSE, message=FALSE, warning=FALSE}
# Select single studies and other demographic variables
data.demo <- data %>%
  select(article_year, ethnicity_reported_yn, 
         education_reported_mean_yn, education_reported_yn,
         profession_reported_yn, ses_reported_yn)

# Compute the reporting of the different demographic variables
data.demo <- data.demo %>%
  mutate(education=if_else(education_reported_mean_yn == 0 & education_reported_yn == 0, "No", "Yes"),
         ethnicity=if_else(ethnicity_reported_yn == 1, "Yes", "No"),
         profession=if_else(profession_reported_yn == 1, "Yes", "No"),
         ses=if_else(ses_reported_yn == 1, "Yes", "No"))

# Count number of articles for each demographic variable by year of publication
data.demo.education <- data.demo %>%
  count(education, article_year) %>%
  ungroup()
data.demo.ethnicity <- data.demo %>%
  count(ethnicity, article_year) %>%
  ungroup()
data.demo.profession <- data.demo %>%
  count(profession, article_year) %>%
  ungroup()
data.demo.ses <- data.demo %>%
  count(ses, article_year) %>%
  ungroup()

# Compute proportion of articles by year of publication
data.demo.education <- data.demo.education %>%
  group_by(article_year) %>%
  mutate(total=sum(n)) %>%
  group_by(education, add=TRUE) %>%
  mutate(per=round(100*n/total,3),
         variable="edu") %>%
  select(article_year, variable, education, per)
colnames(data.demo.education)[3] <- "report"

data.demo.ethnicity <- data.demo.ethnicity %>%
  group_by(article_year) %>%
  mutate(total=sum(n)) %>%
  group_by(ethnicity, add=TRUE) %>%
  mutate(per=round(100*n/total,3),
         variable="ethni") %>%
  select(article_year, variable, ethnicity, per)
colnames(data.demo.ethnicity)[3] <- "report"

data.demo.profession <- data.demo.profession %>%
  group_by(article_year) %>%
  mutate(total=sum(n)) %>%
  group_by(profession, add=TRUE) %>%
  mutate(per=round(100*n/total,3),
         variable="prof") %>%
  select(article_year, variable, profession, per)
colnames(data.demo.profession)[3] <- "report"

data.demo.ses <- data.demo.ses %>%
  group_by(article_year) %>%
  mutate(total=sum(n)) %>%
  group_by(ses, add=TRUE) %>%
  mutate(per=round(100*n/total,3),
         variable="ses") %>%
  select(article_year, variable, ses, per)
colnames(data.demo.ses)[3] <- "report"

# Merge back the datasets together
merge1 <- rbind(data.demo.education, data.demo.ethnicity)
merge2 <- rbind(merge1, data.demo.profession)
data.demo <- rbind(merge2, data.demo.ses)
data.demo$article_year <- as.numeric(data.demo$article_year)
data.demo$per <- as.numeric(data.demo$per)

# Scatter plot of reporting of other demographic variables by year of publication
data.demo.reported <- data.demo %>%
  filter(report == "No") %>%
  mutate(per = (100 - per))

figure10 <- ggplot(data.demo.reported, aes(x=article_year, y=per, color=factor(variable))) +
  geom_point(size=2.5) +
  geom_line(linetype="dashed") +
  theme_apa() +
  xlab("Year of publication") +
  ylab("Proportion of articles") +
  ggtitle("Reporting of other demographic variables") +
  scale_color_viridis_d(name="Variable reported", 
                        labels=c("Education","Ethnicity","Profession","Socio-economic status")) +
  scale_x_continuous(limits=c(1979,2019), breaks=c(1979,1989,1999,2009,2019)) +
  scale_y_continuous(labels=c("0%","25%","50%","75%","100%"), limits=c(0,100)) +
  theme(axis.title=element_text(face="bold", size=12), 
        axis.text=element_text(colour="black", face="bold"),
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8),
        legend.title=element_text(face="bold", size=12),
        legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,0,-10,-10)) 

# Compute percentage of articles that report education
data.education <- data %>%
  filter(education_reported_mean_yn == 1 | education_reported_yn == 1)
percent.education <- round(nrow(data.education)/nrow(data) * 100, 2)

# Compute distribution of the number of categories reported for education
data.education$education_reported_numcategory <- as.numeric(data.education$education_reported_numcategory)

figure11A <- ggplot(data=data.education, aes(x=education_reported_numcategory)) +
  geom_histogram(binwidth=1, aes(y=..density..), colour="black", fill="#2D708EFF") +
  geom_vline(aes(xintercept=mean(education_reported_numcategory, na.rm=TRUE)), 
             color="#D8DE29FF", size=1) +
  theme_apa() +
  ylab("Density") +
  xlab("Education") +
  scale_x_continuous(limits=c(0.5,8.5), breaks=c(1,2,3,4,5,6,7,8)) +
  scale_y_continuous(limits=c(0,0.5), expand=c(0,0)) +
  theme(axis.title=element_text(face="bold", size=12), 
        axis.text=element_text(colour="black", face="bold"),
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8)) 

# Compute percentage of articles that report ethnicity
data.ethnicity <- data %>%
  filter(ethnicity_reported_yn == 1)
percent.ethnicity <- round(nrow(data.ethnicity)/nrow(data) * 100, 2)

# Compute distribution of the number of categories reported for ethnicity
data.ethnicity$ethnicity_reported_numcategory <- as.numeric(data.ethnicity$ethnicity_reported_numcategory)
figure11B <- ggplot(data=data.ethnicity, aes(x=ethnicity_reported_numcategory)) +
  geom_histogram(binwidth=1, aes(y=..density..), colour="black", fill="#2D708EFF") +
  geom_vline(aes(xintercept=mean(ethnicity_reported_numcategory, na.rm=TRUE)), 
             color="#D8DE29FF", size=1) +
  theme_apa() +
  ylab("Density") +
  xlab("Ethnicity") +
  scale_x_continuous(limits=c(0.5,8.5), breaks=c(1,2,3,4,5,6,7,8)) +
  scale_y_continuous(limits=c(0,0.5), expand=c(0,0)) +
  theme(axis.title=element_text(face="bold", size=12), 
        axis.text=element_text(colour="black", face="bold"),
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8)) 

# Compute percentage of articles that report profession
data.profession <- data %>%
  filter(profession_reported_yn == 1)
percent.profession <- round(nrow(data.profession)/nrow(data) * 100, 2)

# Compute distribution of the number of categories reported for profession
data.profession$profession_reported_numcategory <- as.numeric(data.profession$profession_reported_numcategory)
figure11C <- ggplot(data=data.profession, aes(x=profession_reported_numcategory)) +
  geom_histogram(binwidth=1, aes(y=..density..), colour="black", fill="#2D708EFF") +
  geom_vline(aes(xintercept=mean(profession_reported_numcategory, na.rm=TRUE)), 
             color="#D8DE29FF", size=1) +
  theme_apa() +
  ylab("Density") +
  xlab("Profession") +
  scale_x_continuous(limits=c(0.5,8.5), breaks=c(1,2,3,4,5,6,7,8)) +
  scale_y_continuous(limits=c(0,0.5), expand=c(0,0)) +
  theme(axis.title=element_text(face="bold", size=12), 
        axis.text=element_text(colour="black", face="bold"),
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8)) 

# Compute percentage of articles that report ses
data.ses <- data %>%
  filter(ses_reported_yn ==1)
percent.ses <- round(nrow(data.ses)/nrow(data) * 100, 2)

# Compute distribution of the number of categories reported for ses
data.ses$ses_reported_numcategory <- as.numeric(data.ses$ses_reported_numcategory)
figure11D <- ggplot(data=data.ses, aes(x=ses_reported_numcategory)) +
  geom_histogram(binwidth=1, aes(y=..density..), colour="black", fill="#2D708EFF") +
  geom_vline(aes(xintercept=mean(ses_reported_numcategory, na.rm=TRUE)), 
             color="#D8DE29FF", size=1) +
  theme_apa() +
  ylab("Density") +
  xlab("SES") +
  scale_x_continuous(limits=c(0.5,8.5), breaks=c(1,2,3,4,5,6,7,8)) +
  scale_y_continuous(limits=c(0,0.5), expand=c(0,0)) +
  theme(axis.title=element_text(face="bold", size=12), 
        axis.text=element_text(colour="black", face="bold"),
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8)) 
```

```{r Focus, echo=FALSE, message=FALSE, warning=FALSE}
## Sex feature
# Compute percentage of articles focusing on a sex dependent feature
data.focus.sex <- data %>%
  filter(sample_focus_sex_dependent_yn == 1)
percent.focus.sex <- round(nrow(data.focus.sex)/nrow(data) * 100, 2)

# Compute number of articles per sex dependent feature 
sex.dependent <- data.focus.sex %>%
  group_by(sample_focus_sex_dependent) %>%
  tally() %>%
  mutate(n=round((n/nrow(data.focus.sex)*100),1))

# Pie chart of the reported sex dependent features 
pc.sex.dependent <- ggplot(data=sex.dependent, aes(x="", y=n, fill=sample_focus_sex_dependent)) +
  geom_bar(stat="identity", width=1, color="white") +
  coord_polar("y", start=0) +
  geom_text(aes(label=paste0(n, "%")), position=position_stack(vjust=0.5)) +
  ggtitle("Articles focused on a sex dependent feature") +
  labs(fill="Sex dependent feature") +
  scale_fill_brewer(palette="RdBu") +
  theme_apa()

## Clinical feature
# Compute percentage of articles focusing on a clinical feature
data.focus.clinical <- data %>%
  filter(sample_focus_clinical_yn == 1)
percent.focus.clinical <- round(nrow(data.focus.clinical)/nrow(data) * 100, 2)

# Compute number of articles per clinical feature 
clinical <- data.focus.clinical %>%
  group_by(sample_focus_clinical) %>%
  tally() %>%
  mutate(n=round((n/nrow(data.focus.clinical)*100),1))

# Pie chart of the reported clinical features 
pc.clinical <- ggplot(data=clinical, aes(x="", y=n, fill=sample_focus_clinical)) +
  geom_bar(stat="identity", width=1, color="white") +
  coord_polar("y", start=0) +
  geom_text(aes(label=paste0(n, "%")), position=position_stack(vjust=0.5)) +
  ggtitle("Articles focused on a clinical feature") +
  labs(fill="Clinical feature") +
  scale_fill_brewer(palette="RdBu") +
  theme_void()

## Twins
# Compute percentage of articles focusing on twins
data.focus.twins <- data %>%
  filter(sample_focus_twins == 1)
percent.focus.twins <- round(nrow(data.focus.twins)/nrow(data) * 100, 2)

## University students
# Compute percentage of articles focusing on university students
data.focus.students <- data %>%
  filter(sample_focus_university_students == 1)
percent.focus.students <- round(nrow(data.focus.students)/nrow(data) * 100, 2)

## Shift workers
# Compute percentage of articles focusing on shift workers
data.focus.shift <- data %>%
  filter(sample_focus_shift_workers == 1)
percent.focus.shift <- round(nrow(data.focus.shift)/nrow(data) * 100, 2)

## Pregnant women
# Compute percentage of articles focusing on pregnant women
data.focus.pregnant <- data %>%
  filter(sample_focus_pregnant_women == 1)
percent.focus.pregnant <- round(nrow(data.focus.pregnant)/nrow(data) * 100, 2)
```


```{r Disaggregation, echo=FALSE, warning=FALSE, message=FALSE}
# Select articles that report no difference in results based on age vs use age as a covariate
data.diff.age <- data %>%
  filter(analysis_no_difference_age == 1)
data.dis.age <- data %>%
  filter(analysis_disaggregation_age == 1)

# Select articles that report no difference in results based on sex vs use sex as a covariate
data.diff.sex <- data %>%
  filter(analysis_no_difference_sex == 1)
data.dis.sex <- data %>%
  filter(analysis_disaggregation_sex == 1)

# Select articles that report no difference in results based on ethnicity vs use ethnicity as a covariate
data.diff.ethnicity <- data %>%
  filter(analysis_no_difference_ethnicity == 1)
data.dis.ethnicity <- data %>%
  filter(analysis_disaggregation_ethnicity == 1)

# Select articles that report no difference in results based on education vs use education as a covariate
data.diff.education <- data %>%
  filter(analysis_no_difference_education == 1)
data.dis.education <- data %>%
  filter(analysis_disaggregation_education == 1)

# Select articles that report no difference in results based on profession vs use profession as a covariate
data.diff.profession <- data %>%
  filter(analysis_no_difference_profession == 1)
data.dis.profession <- data %>%
  filter(analysis_disaggregation_profession == 1)

# Select articles that report no difference in results based on ses vs use ses as a covariate
data.diff.ses <- data %>%
  filter(analysis_no_difference_ses == 1)
data.dis.ses <- data %>%
  filter(analysis_disaggregation_ses == 1)

# Select single studies and disaggregation variables
data.analysis <- data %>%
  select(article_year, analysis_disaggregation_age, analysis_disaggregation_sex, analysis_disaggregation_ethnicity, 
         analysis_disaggregation_education, analysis_disaggregation_profession, analysis_disaggregation_ses)

# Compute whether articles use demographic variables in the analysis
data.analysis <- data.analysis %>%
  mutate(report=if_else(analysis_disaggregation_age == 1 & analysis_disaggregation_sex == 0 & 
                            analysis_disaggregation_ethnicity == 0 & analysis_disaggregation_education == 0 &
                            analysis_disaggregation_profession == 0 & analysis_disaggregation_ses == 0 , "Age", 
                          if_else(analysis_disaggregation_age == 0 & analysis_disaggregation_sex == 1 & 
                            analysis_disaggregation_ethnicity == 0 & analysis_disaggregation_education == 0 &
                            analysis_disaggregation_profession == 0 & analysis_disaggregation_ses == 0 , "Sex",
                          if_else(analysis_disaggregation_age == 1 & analysis_disaggregation_sex == 1 & 
                            analysis_disaggregation_ethnicity == 0 & analysis_disaggregation_education == 0 &
                            analysis_disaggregation_profession == 0 & analysis_disaggregation_ses == 0 , "Age & Sex",
                          if_else(analysis_disaggregation_age == 1 & analysis_disaggregation_sex == 0 & (
                            analysis_disaggregation_ethnicity == 1 | analysis_disaggregation_education == 1 |
                            analysis_disaggregation_profession == 1 | analysis_disaggregation_ses == 1), "Age +1",
                          if_else(analysis_disaggregation_age == 0 & analysis_disaggregation_sex == 1 & (
                            analysis_disaggregation_ethnicity == 1 | analysis_disaggregation_education == 1 |
                            analysis_disaggregation_profession == 1 | analysis_disaggregation_ses == 1), "Sex +1",
                          if_else(analysis_disaggregation_age == 1 & analysis_disaggregation_sex == 1 & (
                            analysis_disaggregation_ethnicity == 1 | analysis_disaggregation_education == 1 |
                            analysis_disaggregation_profession == 1 | analysis_disaggregation_ses == 1), "Age & Sex +1",
                          if_else((analysis_disaggregation_age == 0 | analysis_disaggregation_sex == 0) & (
                            analysis_disaggregation_ethnicity == 1 | analysis_disaggregation_education == 1 |
                            analysis_disaggregation_profession == 1 | analysis_disaggregation_ses == 1), "Other demographics",
                            "No disaggregation", ))))))))

# Count the number of articles for each condition by year of publication
data.analysis <- data.analysis %>%
  count(report, article_year) %>%
  ungroup()

# Compute the proportion of articles per condition by year of publication
data.analysis <- data.analysis %>%
  group_by(article_year) %>%
  mutate(total=sum(n)) %>%
  group_by(report, add=TRUE) %>%
  mutate(per=round(100*n/total,3))
data.analysis$article_year <- as.numeric(data.analysis$article_year)
data.analysis$per <- as.numeric(data.analysis$per)

# Stacked bar chart of the use of demographic variables in the analysis by year of publication
figure12 <- ggplot(data.analysis, aes(x=article_year, y=per)) +
  geom_col(aes(fill=report)) +
  theme_apa() +
  xlab("Year of publication") +
  ylab("Proportion of articles") +
  ggtitle("Data analysis by demographic variables") +
  labs(fill="Variable reported") +
  scale_fill_viridis_d() +
  scale_x_continuous(breaks=c(1979,1989,1999,2009,2019)) +
  scale_y_continuous(labels=c("0%","25%","50%","75%","100%"), expand=c(0,0)) +
  theme(axis.title=element_text(face="bold", size=12), 
        axis.text=element_text(colour="black", face="bold"), 
        axis.line=element_line(size=0.8), axis.ticks=element_line(size=0.8),
        legend.title=element_text(face="bold", size=12),
        legend.margin=margin(0,0,0,0), legend.box.margin=margin(-10,0,-10,-10))
```


# Results

## Number of analyzed articles

Out of `r as.numeric(nrow(data.original))` identified and pre-screened articles, we included and extracted data from `r as.numeric(nrow(data.included))` (`r round(percent.included)`%). The distribution of years in which the articles were published is non-uniform and we included and extracted data from more recent articles (Fig. 1). In addition, the representation of journals in the final list of articles is non-uniform, not least as the included journals will not have been available for the entire data collection period (1979 and onwards).
  
```{r, fig.cap="Included and analyzed articles by year and journal. More recent articles are more represented, reflecting an overall increase in scientific output.", warning=FALSE, message=FALSE}
figure1
```

We also examined reasons for exclusion among the articles that we did not include and extract data from. These are given in Figure 2. Reasons for exclusion vary somewhat between different years, with articles not reporting original research being excluded at the highest rate on average.

```{r, fig.cap="Normalised distributions of included and excluded articles.", warning=FALSE, message=FALSE}
figure2
```

## Funding

  We examined the reporting of funding sources in included articles. Funding sources were reported by `r round(percent.funding.name)`% of studies, while funding number was also reported in `r round(percent.funding.num)`% of these cases (Fig. 3). Overall, funding by the United States' National Institutes of Health (NIH) represented `r round(percent.funding.NI)`% of the reported funding agencies. `r round(percent.funding.NI.num)`% of the studies funded by the NIH also reported funding number. The second most represented funding agencies were the Australian National Health and Medical Research Council (NHMRC) and the Canadian Institutes of Health Research (CIHR). 
  
```{r, fig.cap="Reporting of funding across years.", warning=FALSE, message=FALSE}
figure3
```

## Geographical location
  
  `r round(100-percent.country.multiple)`% of articles were conducted in a single country. The geographical location of the study was explicitly reported in `r round(percent.country.reported)`% of studies. The country of study was inferred for the rest of the sampled articles. Inference was primarily based on the first author's affiliation. Overall, `r nrow(country.single)` countries were represented. `r round(percent.country.multiple)`% of articles reported multiple countries of study. Figure 4 shows the distribution of study location across time with the eight most represented countries. Across all years, the US is the most represented country.
  
```{r, fig.cap="Gegraphical location of the studies. The eight most represented countries across the entire dataset are individually shown.", warning=FALSE, message=FALSE}
figure4
```

## Sample size

  We examined whether sample size was reported in studies, and the sample sizes reported. Overall, sample size was reported in `r round(percent.ss)`% of studies. We furthermore examined the distribution of samples sizes as a function of the publication year of the article (Fig. 5), showing a wider distribution of sample sizes in more recent articles.

```{r, fig.cap="Sample size of the recruited volunteers as a function of publication year. Numbers are computed on a log-10 scale.", warning=FALSE, message=FALSE}
figure5
```

## Age

  `r round(percent.age)`% of articles reported a variable describing age. Overall, the average mean age of the study populations was `r round(mean(data.age.mean$age_reported_mean_value))` years old. We examined the extent to which the mean age across studies differed widely as a function of publication year (Fig. 6), and found that the mean age is much more widely varied in later years, likely reflecting the extent of considering study samples that are more varied in age.


```{r, fig.cap="Evolution of mean age in included studies as a function of publication year. Fit shown is a linear fit (±95%CI).", warning=FALSE, message=FALSE}
figure8
```

## Sex

  Sex was reported in `r round(percent.sex)`% of the studies. In Figure 7, we show the proportion of studies that recruited male subjects, female subjects, both sexes or did not specify the sex of the participants. `r round(percent.sex.male)`% of the studies reporting sex only recruited male participants, while `r round(percent.sex.female)`% only employed females. Out of the studies focusing on a single gender, `r round(percent.sex.male.focus)`% of the male studies focused on a sex dependent feature, while `r round(percent.sex.female.focus)`% of the female studies did. `r round(percent.sex.age)`% of studies reported age by sex. 
  

```{r, fig.cap="Sex inclusion by year. Proportion of studies that recruited male subjects, female subjects, both sexes, or did not specify the sex of the participants.", warning=FALSE, message=FALSE}
figure9
```


##  Ethnicity, education, profession and socio-economic status

  We examined the reporting of the demographic variables ethnicity, education, profession and socio-economic status. These demographics variables were reported in `r round(percent.education)`% of studies for education, `r round(percent.ethnicity)`% for ethnicity, `r round(percent.profession)`% for profession, and `r round(percent.ses)`% for socio-economic status. Figure 8 shows the distribution of this reporting across the years. Qualitatively, there is a clear increase in the reporting of additional demographic variables over time, with ethnicity being the most reported demographic variable across articles in more recent years.

```{r, fig.cap="test", warning=FALSE, message=FALSE}
figure10
```
  We furthermore examined the number of categories included for each of these demographic variables. In Figure 9, we show the number of categories reported for each variable among those articles that included it in a histogram. On overage, we find that the coding scheme for each of these variables in the included articles comprised between three and four variables. 

```{r, fig.cap="Number of categories reported for education, ethnicity, profession and socio-economic status (SES). Yellow vertical line corresponds to the median.", warning=FALSE, message=FALSE}
grid.arrange(figure11A, figure11B, figure11C, figure11D, nrow=2, top="Number of reported categories")
```


## Study focus

  We considered whether a given article reported on a specific, pre-defined group of people. We find `r round(percent.focus.sex)`% of articles focused on a sex dependent feature, while `r round(percent.focus.clinical)`% investigated a clinical feature. `r round(percent.focus.twins)`% of studies focused on twins, `r round(percent.focus.pregnant)`% on pregnant women, `r round(percent.focus.shift)`% on shift workers and `r round(percent.focus.students)`% on university students. 


## Analysis disaggregation

  We examined the extent to which articles reported subgroup analyses of the data based on one or more of the reported demographic variables. Over time (Fig. 9), we see a distinct evolution of the extent to which subgroup analyses of the study sample were performed. The most common subgroup analyses involve disaggregating by sex, age, or both.
  
  
```{r, fig.cap="Use of study population characteristics as variables in the analysis."}
figure12
```


# Discussion

## Summary of main findings

Here, we considered the inclusion, reporting of `r as.numeric(nrow(data.included))` articles in chronobiology and sleep research, sampled from eight journals. More articles from more recent years are included, with articles originating in the US representing the large group. Over time, we found an increase in the range of sample sizes. We furthermore found a wider spread of average ages included in articles. Across the included articles, we observed an increase in the reporting of demographic variables (ethnicity, education, professional and socioeconomic status) over time, with ethnicity being the most-reported variable in recent years. Of studies included these demographic variables, the number of categories varied widely between studies.

## Taking an inventory of represented study samples reveals the representativeness of our collective knowledge

The ability to generalize findings from the scientific literature to wide and diverse populations of people hinges upon the representativeness of the study sample with respect to demographic categories. The question to what extent the composition of a given study sample can make the generalisability of findings difficult or impossible has received attention in the field of psychology, where many articles published in prominent journals reflected participants from WEIRD (Western, Educated, Industrialized, Rich, and Democratic) contexts [@henrich_weirdest_2010; @muthukrishna_beyond_2020]. In other fields, analyses similar to the one in the present review have been published [@obryant_reporting_2004; @sifers_reporting_2002; @jones_reporting_2020], but to our knowledge, this review represents a first look at the inclusion, reporting and analysis of participant demographics in chronobiology and sleep research.


## The need to consider individual differences

There is convergent knowledge that health and sleep and circadian physiology are subject to large individual differences. Demographic variables provide on lens through which to understand individual differences, and importantly can provide insights into systemic disadvantages and inequities. In the clinical domain, the need to time therapy based on a patient's individual circadian rhythm has more recently become the focus of the emerging field of chronotherapy or chronotherapeutics [@adam_core_2019; @greco_personalized_2020; @dijk_novel_2020; @hill_optimizing_2020]. Understanding interindividual variability needs to become a key research area to understand the circadian and sleep physiology in the face of human diversity.


## Limitations of the current review

We turn to possible limitations of this review and the included analyses and discuss how they might introduce bias in our findings. First, we consider the possibility that the article selection procedure may have introduced biases. Our review only concerned articles from a subset of eight specialized journals. As a consequence, the included articles were necessarily published in these journals, ignoring relevant articles published in other specialized journals (such as those included in the list of candidate journals), and articles published in other, including interdisciplinary journals. This raises the question to what extent we may have missed a section of the literature that would have been relevant to include here. As an alternative strategy, we considered randomly sampling a subset of chronobiology and sleep research articles produced by a general search (e.g. on search from "sleep OR chronobiology" on MEDLINE), but considered this to be too permissive. Our strategy of selecting a subset of candidate journals provided a reasonable trade-off, as well as sampling from a range of field-specific outlets.

Due to the non-uniform distribution of publication years of the included articles (Fig. 1), variables derived from published papers and visualized and/or analyzed by year will have varying uncertainty, with reported percentages from publications of the earlier years being most uncertain. The fact that early years are represented with fewer articles, however, is not a function of our data set, but of the exponential growth of scientific output [@powell_introduction_2017; @bornmann_growth_2015; @parolo_attention_2015].

## Towards standardized reporting of demographic variables: From checklists to schemas?

There are guidelines and/or checklists for standardizing reporting of participant characteristics, such as CONSORT [@schulz_consort_2010] or STROBE [@von_elm_strengthening_2007] (an extensive database for health research reporting guidelines is provided by the Equator Network, https://www.equator-network.org/). Some biomedical journals [e.g. @robinson_transparent_2017] specifically state demographic reporting requirements in the author instructions. Similarly, some organizations may make recommendations of specific reporting items for specific types of study questions [@veitch_cie_2020].

These guidelines and/or checklists are largely focused on *what* is reported and not *how* it is reported. There is, *a priori*, however, no reason to not develop and use a standardized and machine-readable schema for reporting participant characteristics. The FAIR principles state that data should be findable, accessible, interoperable and reusable [@wilkinson_fair_2016], and one way of realizing these criteria is the use of data schemas which could prescribe categories of data and common naming schemes for reporting participant characteristics. Importantly, however, "what gets counted counts" [@dignazio_data_2020], and it will be imperative to understand to what extent such data schema may be exclusionary, e.g., by enforcing gender binaries [@hyde_future_2019], and whether any specific demographic variable is truly important (following the principle of data minimization). A further central point to consider is the extent to which disaggregation by demographic variables could be used to do harm in some way [@dignazio_data_2020].

# Conclusion

This review provided a first look at the inclusion, reporting and analysis of demographic variables in the chronobiology and sleep research literature, considering >1000 articles across eight journals. We addressed the need to consider individual differences, as well as the dependence of sleep and circadian rhythms and demographic variables. Additionally, we outline an opportunity to improve reporting of participant-level characteristics using formalized data schemas.

\newpage

# References

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id="refs" custom-style="Bibliography"></div>
\endgroup
